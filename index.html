<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº¬é˜ªä¹‹æ—…</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Zen Maru Gothic (åŠ å…¥ 900 å­—é‡) -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sakura: {
                            light: '#fff0f5', // æ·ºç²‰ç´…èƒŒæ™¯
                            DEFAULT: '#ffb7c5', // æ«»èŠ±ç²‰
                            dark: '#2EA9DF', // æ·±ç²‰ç´…
                            text: '#5d4037', // æº«æš–çš„æ·±è¤è‰²æ–‡å­—
                        }
                    },
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(255, 183, 197, 0.4)',
                        'card': '0 2px 10px rgba(0,0,0,0.05)',
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'spin-slow': 'spin 8s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* å¼·åˆ¶æ‰€æœ‰å…ƒç´ ä½¿ç”¨ Zen Maru Gothic å­—é«” */
        body, button, input, select, textarea, h1, h2, h3, h4, h5, h6, span, p, div {
            font-family: 'Zen Maru Gothic', sans-serif;
        }

        body {
            background-color: #fff0f5; /* å»¶ä¼¸åº•è‰² */
            -webkit-tap-highlight-color: transparent;
        }
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .app-container {
            max-width: 480px; /* æ¨¡æ“¬æ‰‹æ©Ÿå¯¬åº¦ */
            margin: 0 auto;
            background-color: #fafafa;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            padding-bottom: 80px; /* é¿é–‹åº•éƒ¨å°èˆª */
        }
        /* è¼‰å…¥å‹•ç•« */
        .weather-loading {
            animation: pulse-bg 1.5s infinite;
        }
        @keyframes pulse-bg {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        /* å¡ç‰‡é€²å ´å‹•ç•« */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }

        /* [æ–°å¢] é–‹å ´å‹•ç•«ç›¸é—œ CSS */
        .splash-leave-active {
            transition: opacity 0.8s ease;
        }
        .splash-leave-to {
            opacity: 0;
        }
        
        .sakura-petal {
            position: absolute;
            background-color: #ffb7c5;
            border-radius: 100% 0 100% 0;
            opacity: 0.8;
            /* ä¿®æ­£å‹•ç•«å±¬æ€§ï¼Œç§»é™¤é€™è£¡çš„ durationï¼Œæ”¹ç”± inline style æ§åˆ¶ */
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        @keyframes fall {
            0% { top: -10%; transform: translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 110%; transform: translateX(100px) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body>

<div id="app" class="app-container">
    
    <!-- [æ–°å¢] é–‹å ´å‹•ç•« (Splash Screen) -->
    <transition name="splash">
        <div v-if="showSplash" class="fixed inset-0 z-[100] bg-[#fff0f5] flex flex-col items-center justify-center overflow-hidden">
            <!-- è£é£¾èƒŒæ™¯åœ“åœˆ -->
            <div class="absolute w-96 h-96 bg-white/40 rounded-full blur-3xl animate-pulse"></div>
            
            <!-- é£„è½æ«»èŠ± (CSS å‹•ç•«) - å·²ä¿®æ­£å‹•ç•«æ™‚é–“è¨­å®šæ–¹å¼ -->
            <div class="absolute inset-0 pointer-events-none">
                <span class="sakura-petal w-3 h-3 left-[10%]" style="animation-duration: 4s; animation-delay: 0s;"></span>
                <span class="sakura-petal w-4 h-4 left-[30%]" style="animation-duration: 6s; animation-delay: 1s;"></span>
                <span class="sakura-petal w-2 h-2 left-[70%]" style="animation-duration: 5s; animation-delay: 2s;"></span>
                <span class="sakura-petal w-3 h-3 left-[50%]" style="animation-duration: 7s; animation-delay: 0.5s;"></span>
                <span class="sakura-petal w-4 h-4 left-[85%]" style="animation-duration: 4.5s; animation-delay: 1.5s;"></span>
                <span class="sakura-petal w-2 h-2 left-[20%]" style="animation-duration: 5.5s; animation-delay: 3s;"></span>
                <span class="sakura-petal w-3 h-3 left-[60%]" style="animation-duration: 6.5s; animation-delay: 2.5s;"></span>
                <span class="sakura-petal w-2 h-2 left-[90%]" style="animation-duration: 5s; animation-delay: 0.2s;"></span>
            </div>

            <!-- Logo èˆ‡æ¨™é¡Œ -->
            <div class="relative z-10 text-center animate-float">
                <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-soft border-4 border-white">
                    <i class="fa-solid fa-plane-departure text-4xl text-sakura-dark"></i>
                </div>
                <h1 class="text-4xl font-black text-sakura-text tracking-[0.3em] mb-3 ml-2">äº¬é˜ªä¹‹æ—…</h1>
                <div class="inline-block px-4 py-1 bg-white/60 rounded-full backdrop-blur-sm">
                    <p class="text-sm font-bold text-sakura-dark tracking-widest">READY FOR TRIP</p>
                </div>
            </div>

            <!-- åº•éƒ¨è¼‰å…¥æ–‡å­— -->
            <div class="absolute bottom-12 text-sakura-text/50 text-xs font-bold animate-pulse">
                æ­£åœ¨æ‰“åŒ…ç¾å¥½å›æ†¶...
            </div>
        </div>
    </transition>

    <!-- 1. é é¦– Banner -->
    <header class="relative h-[250px] w-full overflow-hidden bg-gray-200 group">
        <!-- åœ–ç‰‡ä¾†æºç¶å®š bannerImage è®Šæ•¸ -->
        <img 
            :src="bannerImage" 
            alt="Sakura Banner" 
            class="w-full h-full object-cover transition-opacity duration-500"
            referrerpolicy="no-referrer"
            @error="handleImageError" 
        >
        
        <!-- [ä¿®æ­£] è£œå›å€’æ•¸è¨ˆæ™‚å°æ¨™ç±¤ï¼Œä¸¦æ›´æ–°ç‹€æ…‹æ–‡å­— -->
        <div class="absolute top-4 right-4 bg-white/70 backdrop-blur-md px-3 py-1.5 rounded-full text-sakura-text text-xs border border-white/50 shadow-sm flex items-center gap-2 z-20">
            <i class="fa-regular fa-clock"></i>
            <span v-if="daysUntilTrip > 0">è·é›¢å‡ºç™¼é‚„æœ‰ <b>{{ daysUntilTrip }}</b> å¤©</span>
            <span v-else-if="daysUntilTrip >= -4">ç¾å¥½çš„æ—…ç¨‹é€²è¡Œä¸­ âœ¨</span>
            <span v-else>æ—…é€”çµæŸ ğŸ”š</span>
        </div>

        <!-- æ¨™é¡Œ (æ”¹ç‚º Top-6ã€æ·±è‰²å­—ã€åŠ å…¥å¯¦è‰²ç™½åº•) -->
        <div class="absolute top-6 left-6 z-10 bg-white p-3 rounded-2xl border border-white/40 shadow-sm">
            <h1 class="text-3xl font-bold tracking-widest text-sakura-text">äº¬é˜ªä¹‹æ—…</h1>
            <p class="text-sm opacity-90 text-sakura-text/80">2026.04.02 - 04.06</p>
        </div>

      
    </header>
<main class="relative -mt-10 bg-[#fafafa] rounded-t-[40px] px-4 pt-4 min-h-[500px] z-10">


    <!-- åœ“å¼§éŠœæ¥å±¤ & ä¸»å…§å®¹ -->
<div v-if="false"
  class="mx-2 mb-3 rounded-2xl border shadow-soft overflow-hidden select-none"
  :class="cloudSyncWrapClass"
>
  <!-- ä¸Šæ’ï¼šç‹€æ…‹ + æ™‚é–“ + æŒ‰éˆ• -->
  <div class="px-4 py-3 flex items-center justify-between gap-3">
    <div class="flex items-center gap-2 min-w-0">
      <!-- ç‹€æ…‹å°é»é»ï¼ˆæœƒå‘¼å¸ï¼‰ -->
      <span
        class="w-2.5 h-2.5 rounded-full shrink-0"
        :class="cloudSyncDotClass"
      ></span>

      <!-- åœ–ç¤º -->
      <i class="fa-solid shrink-0"
        :class="cloudSyncIconClass"
      ></i>

      <!-- æ–‡å­— -->
      <div class="min-w-0">
        <div class="text-xs font-black leading-tight truncate">
          {{ cloudSyncTitle }}
        </div>
        <div class="text-[10px] opacity-80 truncate">
          {{ cloudSyncSubTitle }}
        </div>
      </div>
    </div>

    <div class="flex items-center gap-2 shrink-0">
      <span v-if="cloudSync.lastSyncedAt" class="text-[10px] opacity-70">
        {{ new Date(cloudSync.lastSyncedAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) }}
      </span>

    </div>
  </div>

  <!-- ä¸‹æ’ï¼šé€²åº¦æ¢ï¼ˆåªæœ‰åŒæ­¥ä¸­æ‰é¡¯ç¤ºï¼‰ -->
  <div v-if="cloudSync.state === 'syncing'" class="px-4 pb-3">
    <div class="h-1.5 rounded-full bg-white/50 overflow-hidden">
      <div class="h-full w-1/3 animate-sync-bar rounded-full bg-white"></div>
    </div>
    <div class="mt-1 text-[10px] opacity-75">è«‹ç¨ç­‰ä¸€ä¸‹ä¸‹â€¦</div>
  </div>

  <!-- éŒ¯èª¤æç¤ºï¼ˆé»æ•´æ¢ä¹Ÿå¯é‡è©¦ï¼‰ -->
  <button
    v-if="cloudSync.state === 'error'"
    class="w-full text-left px-4 pb-3 text-[10px] opacity-90"
    @click.stop="manualCloudSync"
  >
    é»é€™è£¡é‡è©¦ï¼ˆ{{ cloudSync.error || 'æœªçŸ¥åŸå› ' }}ï¼‰
  </button>
</div>
 
        
        <!-- === TAB 1: æ¯æ—¥è¡Œç¨‹è¡¨ === -->
        <div v-if="currentTab === 'itinerary'">
            
            <!-- å¤©æ°£è³‡è¨Š -->
            <div class="bg-gradient-to-br from-blue-50 to-sakura-light/50 rounded-2xl mb-6 shadow-soft overflow-hidden transition-all duration-300 border border-white/50 relative">
                
                <div v-if="weatherLoading" class="absolute inset-0 bg-white/50 backdrop-blur-sm z-20 flex items-center justify-center">
                    <div class="text-sakura-dark animate-pulse flex flex-col items-center">
                        <i class="fa-solid fa-location-dot text-2xl mb-1"></i>
                        <span class="text-xs font-bold">æ›´æ–°å¤©æ°£ä¸­...</span>
                    </div>
                </div>

                <div v-if="currentDayCities.length > 1" class="flex gap-2 px-4 pt-4 overflow-x-auto no-scrollbar z-10 relative">
                    <button 
                        v-for="city in currentDayCities" 
                        :key="city.name"
                        @click="changeWeatherCity(city)"
                        :class="['text-xs px-3 py-1.5 rounded-full border transition-all shadow-sm flex items-center gap-1', weatherData.city === city.name ? 'bg-white text-sakura-dark border-sakura/30 font-bold' : 'bg-white/40 text-gray-500 border-transparent hover:bg-white/60']"
                    >
                        <i class="fa-solid fa-location-dot text-[10px]" :class="weatherData.city === city.name ? 'text-sakura' : 'text-gray-400'"></i>
                        {{ city.name }}
                    </button>
                </div>

                <div @click="toggleWeather" class="p-4 flex items-center justify-between cursor-pointer active:bg-white/30 hover:bg-white/20 transition-colors">
                    <div class="flex items-center gap-3">
                        <i :class="weatherData.icon" class="text-3xl drop-shadow-sm transition-all duration-500" :style="{color: weatherData.iconColor}"></i>
                        <div>
                            <p class="text-sakura-text font-bold text-lg flex items-center gap-2">
                                {{ weatherData.city }}
                                <i class="fa-solid fa-chevron-down text-xs text-gray-400 transition-transform duration-300" :class="{'rotate-180': isWeatherExpanded}"></i>
                            </p>
                            <p class="text-xs text-gray-500">{{ weatherData.description }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-3xl font-bold text-sakura-text tracking-tight">{{ weatherData.temp }}<span class="text-lg align-top">Â°C</span></p>
                        <p class="text-xs text-gray-500 font-medium">é«”æ„Ÿ {{ weatherData.apparentTemp }}Â°C</p>
                    </div>
                </div>

                <div v-if="isWeatherExpanded" class="px-4 pb-4 animate-fade-in">
                    <div class="grid grid-cols-4 gap-2 bg-white/60 rounded-xl p-3 backdrop-blur-sm shadow-inner mb-2">
                        <div class="flex flex-col items-center justify-center p-1">
                            <i class="fa-solid fa-droplet text-blue-400 text-sm mb-1"></i><span class="text-[10px] text-gray-400">æ¿•åº¦</span><span class="text-xs font-bold text-gray-600">{{ weatherData.humidity }}%</span>
                        </div>
                        <div class="flex flex-col items-center justify-center p-1">
                            <i class="fa-solid fa-wind text-gray-400 text-sm mb-1"></i><span class="text-[10px] text-gray-400">é¢¨é€Ÿ</span><span class="text-xs font-bold text-gray-600">{{ weatherData.windSpeed }}m/s</span>
                        </div>
                        <div class="flex flex-col items-center justify-center p-1">
                            <i class="fa-solid fa-umbrella text-purple-400 text-sm mb-1"></i><span class="text-[10px] text-gray-400">é™é›¨</span><span class="text-xs font-bold text-gray-600">{{ weatherData.rain }}mm</span>
                        </div>
                        <div class="flex flex-col items-center justify-center p-1">
                            <i class="fa-solid fa-sun text-orange-400 text-sm mb-1"></i><span class="text-[10px] text-gray-400">ç´«å¤–ç·š</span><span class="text-xs font-bold text-gray-600">{{ weatherData.uvIndex }}</span>
                        </div>
                    </div>

                    <!-- [æ–°å¢] å¤©æ°£é å ±ï¼šæœ€é«˜/æœ€ä½æº«èˆ‡ç©¿è¡£å»ºè­° -->
                    <div class="bg-white/60 rounded-xl p-3 backdrop-blur-sm shadow-inner mb-2">
                        <div class="flex justify-between items-center mb-2 border-b border-gray-200/50 pb-2">
                             <span class="text-xs text-gray-600"><i class="fa-solid fa-temperature-arrow-up text-red-400 mr-1"></i>æœ€é«˜ {{ weatherData.maxTemp }}Â°C</span>
                             <span class="text-xs text-gray-600"><i class="fa-solid fa-temperature-arrow-down text-blue-400 mr-1"></i>æœ€ä½ {{ weatherData.minTemp }}Â°C</span>
                        </div>
                        <div class="text-xs text-gray-600 flex items-start gap-2">
                            <i class="fa-solid fa-shirt text-sakura mt-0.5"></i>
                            <span class="font-medium text-sakura-text">{{ weatherData.clothing }}</span>
                        </div>
                    </div>

                    <div class="mt-1 flex justify-between items-center px-4 text-xs text-gray-500 bg-white/40 rounded-lg py-2">
                        <div class="flex items-center gap-2"><i class="fa-regular fa-sun text-orange-400"></i> æ—¥å‡º {{ weatherData.sunrise }}</div>
                        <div class="h-4 w-px bg-gray-300 opacity-50"></div>
                         <div class="flex items-center gap-2"><i class="fa-regular fa-moon text-indigo-400"></i> æ—¥è½ {{ weatherData.sunset }}</div>
                    </div>
                </div>
            </div>

            <!-- æ—¥æœŸé¸å–® (ç½®ä¸­) -->
            <div class="flex overflow-x-auto no-scrollbar gap-3 mb-4 pb-2 justify-center">
                <button 
                    v-for="(day, index) in days" 
                    :key="index"
                    @click="selectedDate = day.dateStr"
                    :class="['flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl transition-all duration-300 relative overflow-hidden', selectedDate === day.dateStr ? 'bg-sakura text-white shadow-soft transform scale-105' : 'bg-white text-gray-400 border border-gray-100']"
                >
                    <span class="text-lg font-bold z-10">{{ day.dayOfWeek }}</span>
                    <span class="text-sm z-10">{{ day.displayDate }}</span>
                    <span v-if="selectedDate === day.dateStr" class="absolute bottom-1 text-[10px] opacity-80 z-10">{{ day.mainCity }}</span>
                </button>
            </div>

            <!-- è¡Œç¨‹æº«é¦¨æé†’ (å·²ä¿®æ”¹) -->
            <div class="bg-yellow-50 text-yellow-700 text-xs px-4 py-2 rounded-xl mb-4 flex items-center border border-yellow-100 mx-2 shadow-sm">
                <i class="fa-solid fa-circle-exclamation mr-2 text-yellow-500"></i>
                æº«é¦¨æé†’ï¼šäº¤é€šæ™‚é–“çš†ç‚ºé ä¼°ï¼Œå¯¦éš›ä¾ç•¶å¤©ç‹€æ³ç‚ºä¸»ã€‚
            </div>

            <!-- è¡Œç¨‹åˆ—è¡¨ -->
            <div class="space-y-4">
                <div v-for="(item, index) in filteredItinerary" :key="item.id" class="relative pl-4 border-l-2 border-sakura-light">
                    <!-- è¡Œç¨‹å¡ç‰‡ -->
                    <div 
                        class="bg-white rounded-2xl p-4 shadow-card active:scale-[0.98] transition-transform relative group"
                        :class="{'border-l-4 border-sakura': item.category !== 'flight', 'bg-blue-50 border-l-4 border-blue-400': item.category === 'flight'}"
                    >
                        <!-- ç´”ç€è¦½æ¨¡å¼ -->
                        <div class="absolute top-2 right-2 flex gap-2"></div>

                        <div v-if="item.category === 'flight'">
                             <div class="flex justify-between items-start mb-2">
                                <span class="bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded-full font-bold"><i class="fa-solid fa-plane-departure mr-1"></i>èˆªç­</span>
                                <span class="text-xs text-gray-500 font-bold">{{ item.time }}</span>
                            </div>
                            <h3 class="font-bold text-gray-800 text-lg mb-1">{{ item.name }}</h3>
                            <div class="text-sm text-gray-600 space-y-1"><p>{{ item.note }}</p></div>
                        </div>

                        <div v-else>
                            <div class="flex justify-between items-start mb-1">
                                <!-- åˆ†é¡èˆ‡äº¤é€šæ™‚é–“ -->
                                <div class="flex items-center gap-2 mb-2 flex-wrap">
                                    <span
  :class="[
    'text-xs px-2 py-1 rounded-full font-bold inline-block',
    getCategoryColor(item.category)
  ]"
>
  {{ getCategoryLabel(item.category) }}
</span>
                                    
                                    <span v-if="index > 0" class="text-[10px] text-gray-400 flex items-center bg-gray-50 px-2 py-1 rounded-full border border-gray-100">
                                        <i :class="getTransportIcon(item.transportType)" class="mr-1 text-sakura-dark"></i>ç´„ {{ item.travelTime }} åˆ†
                                    </span>
                                    <span v-else-if="index === 0 && selectedDate !== '2026-04-02'" class="text-[10px] text-gray-400 flex items-center bg-gray-50 px-2 py-1 rounded-full border border-gray-100">
                                        <i class="fa-solid fa-hotel mr-1 text-sakura-dark"></i>é£¯åº—å‡ºç™¼ 20åˆ†
                                    </span>
                                </div>

                                <span class="text-sm font-black text-sakura-text bg-sakura-light px-2 py-1 rounded-lg whitespace-nowrap ml-2">{{ item.time }}</span>
                            </div>
                            
                            <!-- [ä¿®æ”¹] æ™¯é»åç¨±é¡¯ç¤º (æ–°å¢åœ“æ¡†åœ–ç‰‡) -->
                            <div class="flex items-center gap-3 mb-2 cursor-pointer group/name" @click="openMap(item.name)">
                                <img v-if="item.image" :src="item.image" class="w-12 h-12 rounded-full object-cover shadow-sm border border-gray-100 shrink-0 group-hover/name:scale-110 transition-transform">
                                <h3 class="font-bold text-gray-800 text-lg flex items-center gap-2 group-hover/name:text-sakura-dark transition-colors">
                                    {{ item.name }} <i class="fa-solid fa-location-arrow text-xs text-sakura"></i>
                                </h3>
                            </div>

                            <div class="space-y-2 text-sm text-gray-600">
                                <div class="flex flex-wrap gap-3 text-xs">
                                    <p v-if="item.category !== 'other' && item.category !== 'accommodation' && item.openHours" class="flex items-center">
                                        <i class="fa-regular fa-clock w-4 text-center text-gray-400 mr-1"></i> {{ item.openHours }}
                                    </p>
                                    <p v-if="item.category === 'attraction' && item.ticket" class="flex items-center">
                                        <i class="fa-solid fa-ticket w-4 text-center text-yellow-500 mr-1"></i> {{ item.ticket }}
                                    </p>
                                </div>

                                <div v-if="item.description" class="text-xs bg-gray-50 p-3 rounded-lg border border-gray-100 leading-relaxed text-gray-500">
                                    <p style="white-space: pre-line;">{{ item.description }}</p>
                                </div>

                                <p v-if="item.note" class="text-xs text-sakura-dark mt-1 flex items-start">
                                    <i class="fa-solid fa-circle-exclamation w-4 mt-0.5 mr-1"></i> {{ item.note }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div v-if="filteredItinerary.length === 0" class="text-center py-10 text-gray-400">
                    <i class="fa-solid fa-mug-hot text-4xl mb-3 opacity-50"></i>
                    <p>æœ¬æ—¥å°šç„¡è¡Œç¨‹</p>
                </div>
            </div>
        </div>


        <!-- === TAB 2: è³‡è¨Š === -->
        <div v-if="currentTab === 'info'" class="space-y-6 pb-20">
            <!-- åŒ¯ç‡æ›ç®— (å·²æ›´æ–°ï¼šé›™å‘è¼¸å…¥ + è‡ªå‹•åŒ¯ç‡) -->
            <div class="bg-white rounded-2xl p-5 shadow-card">
                <h3 class="font-bold text-sakura-text mb-4 border-b pb-2 flex justify-between items-center">
                    <span><i class="fa-solid fa-coins mr-2 text-yellow-500"></i>åŒ¯ç‡æ›ç®—</span>
                    <div class="text-right">
                        <span class="text-xs text-gray-400 font-normal block">æ›´æ–°: {{ today }}</span>
                        <span v-if="currentRate" class="text-[10px] text-sakura-dark font-bold">1 JPY â‰ˆ {{ currentRate }} TWD</span>
                    </div>
                </h3>
                <div class="flex items-center gap-4">
                    <div class="flex-1">
                        <label class="text-xs text-gray-500 mb-1 block">æ—¥å¹£ (JPY)</label>
                        <input type="number" v-model="exchange.jpy" @input="calcTwd" class="w-full bg-gray-50 rounded-xl p-3 outline-none focus:ring-2 focus:ring-sakura" placeholder="Â¥">
                    </div>
                    <i class="fa-solid fa-arrow-right-arrow-left text-gray-300"></i>
                    <div class="flex-1">
                        <label class="text-xs text-gray-500 mb-1 block">å°å¹£ (TWD)</label>
                        <input type="number" v-model="exchange.twd" @input="calcJpy" class="w-full bg-sakura-light rounded-xl p-3 font-bold text-sakura-text outline-none focus:ring-2 focus:ring-sakura" placeholder="NT$">
                    </div>
                </div>
            </div>

            <!-- èˆªç­è³‡è¨Š -->
            <div class="bg-white rounded-2xl p-5 shadow-card">
                <h3 class="font-bold text-sakura-text mb-4 border-b pb-2"><i class="fa-solid fa-plane mr-2 text-blue-400"></i>èˆªç­è³‡è¨Š</h3>
                
                <!-- å»ç¨‹å¡ç‰‡ -->
                <div class="mb-4 bg-blue-50 rounded-xl p-4 border border-blue-100 relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-blue-500 text-white text-xs px-3 py-1 rounded-bl-xl font-bold tracking-wider">å»ç¨‹</div>
                    
                    <div class="flex items-center gap-2 mb-4">
                        <span class="font-black text-xl text-gray-800 tracking-wide">IT-284</span>
                        <span class="text-[10px] text-blue-600 bg-white px-2 py-0.5 rounded-full border border-blue-100 font-bold">å°ç£è™èˆª</span>
                    </div>

                    <div class="flex justify-between items-center text-center mb-4 relative z-10">
                        <div class="text-left">
                            <div class="text-3xl font-black text-gray-800 leading-none">07:00</div>
                            <div class="text-sm font-bold text-gray-600 mt-1">KHH é«˜é›„</div>
                            <div class="text-[10px] text-gray-400 mt-0.5 bg-white/60 inline-block px-1 rounded">åœ‹éš›èˆªå»ˆ</div>
                        </div>
                        
                        <div class="flex flex-col items-center w-1/3 px-2">
                            <span class="text-[10px] text-gray-400 mb-2 font-bold">2h 55m</span>
                            <div class="w-full h-0.5 bg-gray-300 relative flex items-center justify-center">
                                <i class="fa-solid fa-plane-departure text-blue-400 text-sm absolute bg-blue-50 px-1"></i>
                            </div>
                            <span class="text-[10px] text-blue-400 mt-1">ç›´é£›</span>
                        </div>

                        <div class="text-right">
                            <div class="text-3xl font-black text-gray-800 leading-none">10:55</div>
                            <div class="text-sm font-bold text-gray-600 mt-1">KIX é—œè¥¿</div>
                            <div class="text-[10px] text-gray-400 mt-0.5 bg-white/60 inline-block px-1 rounded">ç¬¬ä¸€èˆªå»ˆ</div>
                        </div>
                    </div>

                    <!-- å»ºè­°å ±åˆ°æ™‚é–“ (å»ç¨‹) -->
                    <div class="text-center mb-3">
                        <span class="text-xs font-bold text-blue-600 bg-white border border-blue-200 px-3 py-1 rounded-full shadow-sm">
                            <i class="fa-solid fa-user-clock mr-1"></i>å»ºè­°å ±åˆ°ï¼š05:00
                        </span>
                    </div>

                    <div class="flex justify-between items-center text-xs text-gray-500 border-t border-blue-200/50 pt-3 mt-2">
                        <span class="flex items-center"><i class="fa-regular fa-calendar-check mr-1.5 text-blue-400"></i>2026/04/02 (é€±å››)</span>
                        <span class="flex items-center">
                            <i class="fa-solid fa-suitcase-rolling mr-1 text-blue-400"></i>20kg
                            <span class="mx-1 text-blue-200">|</span>
                            <i class="fa-solid fa-briefcase mr-1 text-blue-400"></i>10kg
                            <span class="mx-1 text-blue-200">|</span>
                            <i class="fa-solid fa-utensils mr-1 text-blue-400"></i>å«é¤
                        </span>
                    </div>
                </div>

                <!-- å›ç¨‹å¡ç‰‡ -->
                <div class="bg-sakura-light/40 rounded-xl p-4 border border-sakura-light relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-sakura text-white text-xs px-3 py-1 rounded-bl-xl font-bold tracking-wider">å›ç¨‹</div>
                    
                    <div class="flex items-center gap-2 mb-4">
                        <span class="font-black text-xl text-gray-800 tracking-wide">IT-285</span>
                        <span class="text-[10px] text-sakura-dark bg-white px-2 py-0.5 rounded-full border border-sakura-light font-bold">å°ç£è™èˆª</span>
                    </div>

                    <div class="flex justify-between items-center text-center mb-4 relative z-10">
                        <div class="text-left">
                            <div class="text-3xl font-black text-gray-800">12:00</div>
                            <div class="text-sm font-bold text-gray-600 mt-1">KIX é—œè¥¿</div>
                            <div class="text-[10px] text-gray-400 mt-0.5 bg-white/60 inline-block px-1 rounded">ç¬¬ä¸€èˆªå»ˆ</div>
                        </div>
                        
                        <div class="flex flex-col items-center w-1/3 px-2">
                            <span class="text-[10px] text-gray-400 mb-2 font-bold">3h 0m</span>
                            <div class="w-full h-0.5 bg-gray-300 relative flex items-center justify-center">
                                <i class="fa-solid fa-plane-departure text-sakura text-sm absolute bg-sakura-light/40 px-1"></i>
                            </div>
                            <span class="text-[10px] text-sakura mt-1">ç›´é£›</span>
                        </div>

                        <div class="text-right">
                            <div class="text-3xl font-black text-gray-800 leading-none">14:00</div>
                            <div class="text-sm font-bold text-gray-600 mt-1">KHH é«˜é›„</div>
                            <div class="text-[10px] text-gray-400 mt-0.5 bg-white/60 inline-block px-1 rounded">åœ‹éš›èˆªå»ˆ</div>
                        </div>
                    </div>

                    <!-- å»ºè­°å ±åˆ°æ™‚é–“ (å›ç¨‹) -->
                    <div class="text-center mb-3">
                        <span class="text-xs font-bold text-sakura-text bg-white border border-sakura-light px-3 py-1 rounded-full shadow-sm">
                            <i class="fa-solid fa-user-clock mr-1 text-sakura"></i>å»ºè­°å ±åˆ°ï¼š10:00
                        </span>
                    </div>

                    <div class="flex justify-between items-center text-xs text-gray-500 border-t border-sakura-light pt-3 mt-2">
                        <span class="flex items-center"><i class="fa-regular fa-calendar-check mr-1.5 text-sakura"></i>2026/04/06 (é€±ä¸€)</span>
                        <span class="flex items-center">
                            <i class="fa-solid fa-suitcase-rolling mr-1 text-sakura"></i>25kg
                            <span class="mx-1 text-sakura-light">|</span>
                            <i class="fa-solid fa-briefcase mr-1 text-sakura"></i>10kg
                            <span class="mx-1 text-sakura-light">|</span>
                            <i class="fa-solid fa-utensils mr-1 text-sakura"></i>å«é¤
                        </span>
                    </div>
                </div>
            </div>

            <!-- ä½å®¿è³‡è¨Š -->
            <div class="bg-white rounded-2xl p-5 shadow-card">
                 <h3 class="font-bold text-sakura-text mb-4 border-b pb-2"><i class="fa-solid fa-bed mr-2 text-purple-400"></i>ä½å®¿è³‡è¨Š</h3>
                 <h4 class="font-bold text-lg mb-1">æ±æ€¥ STAY å¤§é˜ªæœ¬ç”º</h4>
                 <div class="flex gap-2 mb-3">
                     <a href="https://www.google.com/maps/search/?api=1&query=æ±æ€¥STAYå¤§é˜ªæœ¬ç”º" target="_blank" class="flex-1 bg-sakura text-white py-2 rounded-xl text-center text-sm shadow-md active:scale-95 transition-transform"><i class="fa-solid fa-location-dot mr-1"></i> å°èˆª</a>
                     <a href="tel:+81612345678" class="flex-1 bg-gray-100 text-gray-600 py-2 rounded-xl text-center text-sm active:scale-95 transition-transform"><i class="fa-solid fa-phone mr-1"></i> é›»è©±</a>
                 </div>
                 <p class="text-xs text-gray-400">å¤§é˜ªåºœå¤§é˜ªå¸‚ä¸­å¤®å€ä¹…å¤ªéƒç”º 2-4-24</p>
            </div>
            
            <!-- [æ›´æ–°] æ—…è¡Œæº«é¦¨æé†’ -->
            <div class="bg-white rounded-2xl p-5 shadow-card border-l-4 border-yellow-400">
                <h3 class="font-bold text-gray-700 mb-3"><i class="fa-solid fa-lightbulb text-yellow-400 mr-2"></i>æ—…è¡Œæº«é¦¨æé†’</h3>
                <ul class="text-xs text-gray-600 space-y-2 list-disc pl-4">
                    <li><b>æ³¨æ„äº‹é …</b>ï¼š
                        <ol class="list-decimal pl-4 mt-1 space-y-1 text-gray-500">
                            <li>è¡Œç¨‹å«SIMå¡ï¼Œä¸ç”¨å†å¦å¤–è³¼è²·ã€‚</li>
                            <li>è‡ªç”±è¡Œæ¯æ—¥ç´„ç‚º20000æ­¥ä»¥ä¸Šï¼Œå¤§å®¶ä¸€èµ·åŠ æ²¹~å›é£¯åº—ä¼‘æ¯å¾Œåˆ¥å¿˜äº†è®“è…³å¥½å¥½ä¼‘æ¯å”·ï¼</li>
                            <li>å€‹äººè—¥å“è«‹å‹™å¿…è¨˜å¾—æ”œå¸¶ã€‚</li>
                        </ol>
                    </li>
                    <li><b>è­·ç…§èˆ‡ç°½è­‰</b>ï¼šè«‹ç¢ºèªè­·ç…§æœ‰æ•ˆæœŸè¶…é 6 å€‹æœˆï¼Œä¸¦äº‹å…ˆå¡«å¯« Visit Japan Webã€‚</li>
                    <li><b>é›»å£“èˆ‡æ’åº§</b>ï¼šæ—¥æœ¬é›»å£“ç‚º 100Vï¼Œæ’åº§ç‚ºé›™å­”æ‰å¹³ï¼ˆèˆ‡å°ç£ç›¸åŒï¼‰ï¼Œé€šå¸¸ä¸éœ€è½‰æ¥é ­ã€‚</li>
                    <li><b>ç¦®å„€</b>ï¼šé›»è»Šå…§è«‹ä¿æŒå®‰éœï¼Œæ‰‹æ©Ÿèª¿æˆéœéŸ³ã€‚èµ°è·¯è«‹é å·¦å´é€šè¡Œï¼ˆå¤§é˜ªéƒ¨åˆ†æ‰‹æ‰¶æ¢¯é å³ï¼Œä¾å¾ªå‰äººå³å¯ï¼‰ã€‚</li>
                    <li><b>å°è²»</b>ï¼šæ—¥æœ¬ç„¡å°è²»æ–‡åŒ–ï¼Œæœå‹™è²»é€šå¸¸å·²åŒ…å«åœ¨å¸³å–®å…§ã€‚</li>
                    <li><b>åƒåœ¾</b>ï¼šè¡—ä¸Šåƒåœ¾æ¡¶å¾ˆå°‘ï¼Œè«‹éš¨èº«æ”œå¸¶å¡‘è† è¢‹è£åƒåœ¾ï¼Œå›é£¯åº—å†ä¸Ÿã€‚</li>
                    <li><b>æ”¯ä»˜æ–¹å¼</b>ï¼šç¾é‡‘/ä¿¡ç”¨å¡(TOUCH)/Pay pay</li>
                </ul>
            </div>

            <!-- [æ–°å¢] è¡Œææª¢æŸ¥æ¸…å–® (åˆ†äºº + æ–°å¢åŠŸèƒ½ + é–“è·ç¸®çŸ­) -->
            <div class="bg-white rounded-2xl p-5 shadow-card">
                <h3 class="font-bold text-sakura-text mb-3 border-b pb-2 flex justify-between items-center">
                    <span><i class="fa-solid fa-suitcase-rolling mr-2 text-sakura"></i>è¡Œææª¢æŸ¥æ¸…å–®</span>
                </h3>
                
                <!-- è¡Œææ¸…å–®ï¼šäººå“¡åˆ‡æ› (å·²åŠ å…¥ justify-center ç½®ä¸­) -->
                <div class="flex gap-2 overflow-x-auto no-scrollbar mb-3 pb-1 justify-center">
                    <button 
                        v-for="person in packingPeople" 
                        :key="person"
                        @click="currentPackingFilter = person"
                        :class="[
                            'px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors border',
                            (currentPackingFilter === person) ? 'bg-sakura text-white border-sakura shadow-md' : 'bg-white text-gray-500 border-gray-200'
                        ]"
                    >
                        {{ person }}
                    </button>
                </div>

                <!-- è¡Œææ¸…å–®ï¼šå…§å®¹ (é–“è·ç¸®å°ï¼šspace-y-0.5, py-0) -->
                <div class="space-y-0.5 mb-4">
                    <div v-if="!packingData[currentPackingFilter] || packingData[currentPackingFilter].length === 0" class="text-center text-gray-400 py-4 text-xs">
                        <i class="fa-solid fa-clipboard-check mb-1"></i><br>ç›®å‰æ²’æœ‰é …ç›®
                    </div>
                    <div v-for="(item, index) in packingData[currentPackingFilter]" :key="item.id" class="flex items-center gap-3 py-0.5 px-2 rounded-lg transition-colors hover:bg-gray-50 group border border-transparent hover:border-gray-100">
                        <label class="flex items-center gap-3 flex-1 cursor-pointer">
                            <div class="relative flex items-center justify-center">
                                <input type="checkbox" v-model="item.checked" class="peer appearance-none w-5 h-5 border-2 border-gray-300 rounded-md checked:bg-sakura checked:border-sakura transition-colors">
                                <i class="fa-solid fa-check text-white text-xs absolute opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity"></i>
                            </div>
                            <span :class="{'line-through text-gray-400': item.checked, 'text-gray-600': !item.checked}" class="text-sm font-medium transition-colors select-none">
                                {{ item.text }}
                            </span>
                        </label>
                        <button @click="removePackingItem(index)" class="text-gray-300 hover:text-red-400 p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                </div>

                <!-- è¡Œææ¸…å–®ï¼šæ–°å¢ -->
                <div class="flex gap-2">
                    <input type="text" v-model="newPackingItem" placeholder="æ–°å¢æª¢æŸ¥é …ç›®..." class="flex-1 bg-gray-50 rounded-lg px-3 py-2 text-sm outline-none border focus:border-sakura" @keyup.enter="addPackingItem">
                    <button @click="addPackingItem" class="bg-sakura text-white px-3 py-2 rounded-lg text-sm font-bold shadow-sm active:scale-95 transition-transform"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>
        </div>

        <!-- === TAB 3: è³¼ç‰©æ¸…å–® (æ–°å¢æˆå“¡éæ¿¾) === -->
        <div v-if="currentTab === 'shopping'">
            
            <!-- æˆå“¡éæ¿¾å™¨ (å·²åŠ å…¥ justify-center ç½®ä¸­) -->
<div class="flex gap-2 overflow-x-auto no-scrollbar mb-4 px-1 justify-center">
  <button
    v-for="traveler in shoppingTravelers"
    :key="traveler"
    @click="currentShoppingFilter = traveler"
    :class="[
      'px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors border',
      (currentShoppingFilter === traveler)
        ? 'bg-sakura text-white border-sakura shadow-md'
        : 'bg-white text-gray-500 border-gray-200'
    ]"
  >
    {{ traveler }}
  </button>
</div>

            <!-- è³¼ç‰©æº«é¦¨æé†’ -->
            <div class="bg-pink-50 text-pink-700 text-xs px-4 py-2 rounded-xl mb-4 flex items-center border border-pink-100 mx-2 shadow-sm animate-pulse">
                <i class="fa-solid fa-wallet mr-2 text-pink-500"></i>
                æº«é¦¨æé†’ï¼šæ—¥æœ¬æ˜¯å…ç¨…ä¸æ˜¯å…è²»å”·~ è«‹ç†æ€§è³¼ç‰© (ç¬‘)
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, index) in filteredShoppingList" :key="item.id" class="bg-white rounded-2xl overflow-hidden shadow-card relative group">
                    <div class="h-32 bg-gray-100 relative overflow-hidden">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-gray-300"><i class="fa-solid fa-image text-3xl"></i></div>
                         <button @click="deleteShoppingItem(item.id)" class="absolute top-1 right-1 bg-white/80 w-6 h-6 rounded-full text-red-400 text-xs flex items-center justify-center shadow-sm z-20"><i class="fa-solid fa-xmark"></i></button>
                         <button @click.stop="openModal('shopping', item)" class="absolute top-1 left-1 bg-white/80 w-6 h-6 rounded-full text-blue-400 text-xs flex items-center justify-center shadow-sm z-20"><i class="fa-solid fa-pen"></i></button>
                         <!-- é¡¯ç¤ºæ“æœ‰è€…æ¨™ç±¤ -->
                         <span class="absolute bottom-1 left-1 bg-black/50 text-white text-[10px] px-2 py-0.5 rounded-full backdrop-blur-sm">{{ item.owner || 'æœªæŒ‡å®š' }}</span>
                    </div>
                    <div class="p-3">
                        <h4 class="font-bold text-gray-700 text-sm truncate">{{ item.name }}</h4>
                        <div class="flex items-center gap-1 mt-2">
                             <input type="checkbox" v-model="item.bought" class="accent-sakura w-4 h-4 rounded-full">
                             <span class="text-xs text-gray-500" :class="{'line-through': item.bought}">å·²è³¼è²·</span>
                        </div>
                    </div>
                </div>
            </div>
             <div v-if="filteredShoppingList.length === 0" class="text-center py-10 text-gray-400"><i class="fa-solid fa-basket-shopping text-4xl mb-3 opacity-50"></i><p>é‚„æ²’æœ‰ç›¸é—œç´€éŒ„å–”</p></div>
            <button @click="openModal('shopping')" class="fixed bottom-24 right-6 w-14 h-14 bg-sakura text-white rounded-full shadow-lg flex items-center justify-center text-2xl hover:bg-sakura-dark transition-colors z-20"><i class="fa-solid fa-plus"></i></button>
        </div>

        <!-- === TAB 4: èŠ±è²» (æ–°å¢æˆå“¡éæ¿¾) === -->
        <div v-if="currentTab === 'expense'">
            
            <!-- æˆå“¡éæ¿¾å™¨ (å·²åŠ å…¥ justify-center ç½®ä¸­) -->
            <div class="flex gap-2 overflow-x-auto no-scrollbar mb-4 px-1 justify-center">
                <button 
                    v-for="traveler in travelers" 
                    :key="traveler"
                    @click="currentMemberFilter = traveler"
                    :class="[
                        'px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors border',
                        (currentMemberFilter === traveler) ? 'bg-sakura text-white border-sakura shadow-md' : 'bg-white text-gray-500 border-gray-200'
                    ]"
                >
                    {{ traveler }}
                </button>
                 <button @click="currentMemberFilter = null" :class="['px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors border', !currentMemberFilter ? 'bg-sakura text-white border-sakura shadow-md' : 'bg-white text-gray-500 border-gray-200']">å…¨éƒ¨</button>
            </div>

            <div class="bg-gradient-to-r from-sakura to-sakura-dark rounded-2xl p-6 text-white shadow-soft mb-6 text-center transition-all duration-300">
                <p class="text-sm opacity-90 mb-1 flex items-center justify-center gap-2">
                    <i class="fa-solid fa-user-tag text-xs"></i> 
                    {{ currentMemberFilter ? currentMemberFilter + ' çš„èŠ±è²»' : 'ç›®å‰ç¸½èŠ±è²»' }} (JPY)
                </p>
                <h2 class="text-4xl font-bold font-mono">Â¥ {{ filteredTotalExpense.toLocaleString() }}</h2>
                <p class="text-xs opacity-70 mt-2">ç´„ TWD {{ Math.round(filteredTotalExpense * (currentRate || 0.218)).toLocaleString() }}</p>
            </div>

            <div class="bg-white rounded-t-2xl shadow-card min-h-[300px]">
                <div v-for="(item, index) in filteredExpenses" :key="item.id" class="p-4 border-b border-gray-50 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-lg"><i :class="getExpenseIcon(item.category)" class="text-sakura-dark"></i></div>
                        <div>
                            <h4 class="font-bold text-gray-800">{{ item.name }}</h4>
                            <p class="text-xs text-gray-400">
                                {{ item.date }} Â· {{ item.method }} 
                                <span class="ml-1 bg-gray-100 text-gray-500 px-1.5 rounded text-[10px]">{{ item.owner || 'æœªæŒ‡å®š' }}</span>
                            </p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-gray-800 font-mono">Â¥{{ Number(item.amount).toLocaleString() }}</p>
                        <!-- [æ–°å¢] èŠ±è²»ç·¨è¼¯èˆ‡åˆªé™¤æŒ‰éˆ• -->
                        <div class="flex gap-2 justify-end mt-1">
                            <button @click.stop="openModal('expense', item)" class="text-xs text-blue-400 font-bold hover:text-blue-600"><i class="fa-solid fa-pen"></i></button>
                            <button @click="deleteExpense(item.id)" class="text-xs text-red-300 hover:text-red-500"><i class="fa-solid fa-trash-can"></i></button>
                        </div>
                    </div>
                </div>
                <div v-if="filteredExpenses.length === 0" class="text-center py-8 text-gray-400 text-sm">æ­¤åˆ†é¡ä¸‹ç„¡ç´€éŒ„</div>
            </div>
            <button @click="openModal('expense')" class="fixed bottom-24 right-6 w-14 h-14 bg-sakura text-white rounded-full shadow-lg flex items-center justify-center text-2xl hover:bg-sakura-dark transition-colors z-20"><i class="fa-solid fa-plus"></i></button>
        </div>

        <!-- === [æ–°å¢] TAB 5: å€‹äººç­†è¨˜æœ¬ === -->
        <div v-if="currentTab === 'notebook'">
            <!-- æˆå“¡éæ¿¾å™¨ (å·²åŠ å…¥ justify-center ç½®ä¸­) -->
            <div class="flex gap-2 overflow-x-auto no-scrollbar mb-4 px-1 justify-center">
                <button 
                    v-for="traveler in notebookOwners" 
                    :key="traveler"
                    @click="currentNotebookFilter = traveler"
                    :class="[
                        'px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors border',
                        (currentNotebookFilter === traveler) ? 'bg-sakura text-white border-sakura shadow-md' : 'bg-white text-gray-500 border-gray-200'
                    ]"
                >
                    {{ traveler }}
                </button>
            </div>

            <!-- ç­†è¨˜åˆ—è¡¨ -->
            <div class="grid gap-3 pb-24">
                <div v-if="filteredNotebookList.length === 0" class="text-center py-10 text-gray-400">
                    <i class="fa-solid fa-book-open text-4xl mb-3 opacity-50"></i>
                    <p>é€™è£¡ç©ºç©ºçš„ï¼Œè¨˜é»ä»€éº¼å§ï¼</p>
                </div>
                <div v-for="note in filteredNotebookList" :key="note.id" class="bg-white p-4 rounded-2xl shadow-card relative group border-l-4 border-sakura-light">
                    <h4 class="font-bold text-gray-800 mb-1">{{ note.title }}</h4>
                    <p class="text-sm text-gray-600 whitespace-pre-line leading-relaxed">{{ note.content }}</p>
                    <div class="mt-3 flex justify-between items-end border-t border-gray-50 pt-2">
                        <span class="text-[10px] text-gray-400">{{ new Date(note.id).toLocaleDateString() }}</span>
                        <!-- [ä¿®æ”¹] æ–°å¢ç·¨è¼¯æŒ‰éˆ•å€å¡Š -->
                        <div class="flex gap-3">
                            <button @click.stop="openModal('notebook', note)" class="text-xs text-blue-400 hover:text-blue-600 font-bold">
                                <i class="fa-solid fa-pen mr-1"></i>ç·¨è¼¯
                            </button>
                            <button @click="deleteNote(note.id)" class="text-xs text-red-300 hover:text-red-500 font-bold">
                                <i class="fa-solid fa-trash-can mr-1"></i>åˆªé™¤
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <button @click="openModal('notebook')" class="fixed bottom-24 right-6 w-14 h-14 bg-sakura text-white rounded-full shadow-lg flex items-center justify-center text-2xl hover:bg-sakura-dark transition-colors z-20"><i class="fa-solid fa-plus"></i></button>
        </div>

    </main>

    <!-- åº•éƒ¨å°èˆª -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 flex justify-around items-center h-20 px-2 pb-2 rounded-t-[20px] shadow-[0_-5px_20px_rgba(0,0,0,0.03)] z-40 max-w-[480px] mx-auto">
        <button v-for="tab in tabs" :key="tab.id" @click="currentTab = tab.id" class="flex flex-col items-center justify-center w-16 h-16 transition-all">
            <div class="w-10 h-6 flex items-center justify-center rounded-full mb-1 transition-all" :class="currentTab === tab.id ? 'bg-sakura-light text-sakura-dark' : 'text-gray-400'"><i :class="tab.icon" class="text-lg"></i></div>
            <span class="text-[10px] font-bold transition-all" :class="currentTab === tab.id ? 'text-sakura-text' : 'text-gray-400'">{{ tab.name }}</span>
        </button>
    </nav>

    <!-- Modal -->
    <div v-if="modal.show" class="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center animate-fade-in">
        <div class="bg-white w-full max-w-[480px] rounded-t-[20px] sm:rounded-2xl p-6 shadow-2xl animate-slide-up max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-sakura-text">{{ modal.title }}</h3><button @click="closeModal" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button></div>
            
            <div v-if="modal.type === 'itinerary'" class="space-y-4">
                <div><label class="block text-xs font-bold text-gray-500 mb-1">åˆ†é¡</label><select v-model="formData.category" class="w-full bg-gray-50 rounded-xl p-3">
  <option value="attraction">æ™¯é»</option>
  <option value="transport">äº¤é€š</option>
  <option value="food">ç¾é£Ÿ</option>
  <option value="shopping">è³¼ç‰©</option>
  <option value="accommodation">ä½å®¿</option>
  <option value="flight">èˆªç­</option>
  <option value="other">å…¶ä»–</option>
</select>
</div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">åç¨±</label><input type="text" v-model="formData.name" class="w-full bg-gray-50 rounded-xl p-3 border focus:border-sakura outline-none"></div>
                <div class="flex gap-3"><div class="flex-1"><label class="block text-xs font-bold text-gray-500 mb-1">æ™‚é–“</label><input type="time" v-model="formData.time" class="w-full bg-gray-50 rounded-xl p-3 border outline-none"></div><div class="flex-1"><label class="block text-xs font-bold text-gray-500 mb-1">äº¤é€šæ™‚é–“(åˆ†)</label><input type="number" v-model="formData.travelTime" class="w-full bg-gray-50 rounded-xl p-3 border outline-none" placeholder="30"></div></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">äº¤é€šæ–¹å¼</label><select v-model="formData.transportType" class="w-full bg-gray-50 rounded-xl p-3"><option value="walk">æ­¥è¡Œ</option><option value="transit">å¤§çœ¾é‹è¼¸</option></select></div>
                <div v-if="['attraction', 'food', 'shopping'].includes(formData.category)"><label class="block text-xs font-bold text-gray-500 mb-1">ç‡Ÿæ¥­æ™‚é–“</label><input type="text" v-model="formData.openHours" class="w-full bg-gray-50 rounded-xl p-3 border outline-none" placeholder="09:00 - 20:00"></div>
                <div v-if="formData.category === 'attraction'"><label class="block text-xs font-bold text-gray-500 mb-1">é–€ç¥¨è³‡è¨Š</label><input type="text" v-model="formData.ticket" class="w-full bg-gray-50 rounded-xl p-3 border outline-none" placeholder="Â¥1000"></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">å‚™è¨»</label><textarea v-model="formData.note" class="w-full bg-gray-50 rounded-xl p-3 border outline-none h-20"></textarea></div>
                <div v-if="modal.isEdit" class="pt-2"><button @click="confirmDeleteItinerary" class="w-full py-3 text-red-400 text-sm font-bold border border-red-100 rounded-xl hover:bg-red-50">åˆªé™¤æ­¤è¡Œç¨‹</button></div>
            </div>

            <div v-if="modal.type === 'shopping'" class="space-y-4">
                <!-- èª°çš„æ¸…å–® (æ”¹ç”¨ shoppingTravelersï¼Œæ’é™¤å…¬è²») -->
                <div><label class="block text-xs font-bold text-gray-500 mb-1">æ˜¯èª°è¦è²·çš„ï¼Ÿ</label><select v-model="formData.owner" class="w-full bg-blue-50 text-blue-800 font-bold rounded-xl p-3 border-blue-200"><option v-for="t in shoppingOwners" :value="t">{{ t }}</option></select></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">å•†å“åç¨±</label><input type="text" v-model="formData.name" class="w-full bg-gray-50 rounded-xl p-3 border focus:border-sakura outline-none"></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">åœ–ç‰‡</label><div class="relative w-full h-32 bg-gray-100 rounded-xl flex items-center justify-center border-2 border-dashed border-gray-300 overflow-hidden"><input type="file" @change="handleImageUpload" class="absolute inset-0 opacity-0 cursor-pointer"><img v-if="formData.image" :src="formData.image" class="w-full h-full object-cover"><div v-else class="text-center text-gray-400"><i class="fa-solid fa-camera mb-1"></i><p class="text-xs">é»æ“Šä¸Šå‚³åœ–ç‰‡</p></div></div></div>
            </div>

            <div v-if="modal.type === 'expense'" class="space-y-4">
                <!-- èª°ä»˜éŒ¢ -->
                <div><label class="block text-xs font-bold text-gray-500 mb-1">æ˜¯èª°ä»˜çš„éŒ¢ï¼Ÿ</label><select v-model="formData.owner" class="w-full bg-blue-50 text-blue-800 font-bold rounded-xl p-3 border-blue-200"><option v-for="t in travelers" :value="t">{{ t }}</option></select></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">æ—¥æœŸ</label><select v-model="formData.date" class="w-full bg-gray-50 rounded-xl p-3"><option v-for="day in days" :value="day.dateStr">{{ day.displayDate }}</option></select></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">é¡åˆ¥</label><select v-model="formData.category" class="w-full bg-gray-50 rounded-xl p-3"><option value="transport">äº¤é€š</option><option value="food">é£²é£Ÿ</option><option value="accommodation">ä½å®¿</option><option value="ticket">é–€ç¥¨</option><option value="shopping">è³¼ç‰©</option><option value="gambling">åšå¼ˆ</option><option value="other">å…¶ä»–</option></select></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">åç¨±</label><input type="text" v-model="formData.name" class="w-full bg-gray-50 rounded-xl p-3 border focus:border-sakura outline-none"></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">é‡‘é¡ (JPY)</label><input type="number" v-model="formData.amount" class="w-full bg-gray-50 rounded-xl p-3 border focus:border-sakura outline-none"></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">ä»˜æ¬¾æ–¹å¼</label><div class="flex gap-2"><label class="flex-1 bg-gray-50 p-3 rounded-xl flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-sakura-light has-[:checked]:text-sakura-dark"><input type="radio" v-model="formData.method" value="ç¾é‡‘" class="hidden"><i class="fa-solid fa-coins"></i> ç¾é‡‘</label><label class="flex-1 bg-gray-50 p-3 rounded-xl flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-sakura-light has-[:checked]:text-sakura-dark"><input type="radio" v-model="formData.method" value="ä¿¡ç”¨å¡" class="hidden"><i class="fa-solid fa-credit-card"></i> ä¿¡ç”¨å¡</label></div></div>
            </div>

            <!-- [æ–°å¢] ç­†è¨˜æœ¬ Modal -->
            <div v-if="modal.type === 'notebook'" class="space-y-4">
                <div><label class="block text-xs font-bold text-gray-500 mb-1">ç­†è¨˜æ“æœ‰è€…</label><select v-model="formData.owner" class="w-full bg-blue-50 text-blue-800 font-bold rounded-xl p-3 border-blue-200"><option v-for="t in notebookOwners" :value="t">{{ t }}</option></select></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">æ¨™é¡Œ</label><input type="text" v-model="formData.title" class="w-full bg-gray-50 rounded-xl p-3 border focus:border-sakura outline-none" placeholder="ä¾‹å¦‚ï¼šæƒ³è²·çš„æ±è¥¿ã€æ³¨æ„äº‹é …..."></div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">å…§å®¹</label><textarea v-model="formData.content" class="w-full bg-gray-50 rounded-xl p-3 border outline-none h-40" placeholder="å¯«é»ä»€éº¼..."></textarea></div>
            </div>

            <button @click="submitForm" class="w-full bg-sakura text-white font-bold py-4 rounded-xl mt-6 shadow-soft hover:bg-sakura-dark transition-colors">{{ modal.isEdit ? 'å„²å­˜è®Šæ›´' : 'æ–°å¢' }}</button>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, reactive, onMounted, watch } = Vue;

    createApp({
        setup() {
            // [æ–°å¢] ç‹€æ…‹è®Šæ•¸ï¼šæ§åˆ¶ Splash é¡¯ç¤º
            const showSplash = ref(true);

            // [æ–°å¢] åœ¨ onMounted è¨­å®š 5 ç§’å¾Œéš±è—å‹•ç•«
            onMounted(() => {
                setTimeout(() => {
                    showSplash.value = false;
                }, 5000); // æ”¹ç‚º 5 ç§’å¾Œæ·¡å‡º
            });

            const currentTab = ref('itinerary');
            const tabs = [
                { id: 'itinerary', name: 'è¡Œç¨‹è¡¨', icon: 'fa-solid fa-map-location-dot' },
                { id: 'info', name: 'è³‡è¨Š', icon: 'fa-solid fa-circle-info' },
                { id: 'shopping', name: 'è³¼ç‰©æ¸…å–®', icon: 'fa-solid fa-basket-shopping' },
                { id: 'expense', name: 'èŠ±è²»', icon: 'fa-solid fa-yen-sign' },
                { id: 'notebook', name: 'ç­†è¨˜æœ¬', icon: 'fa-solid fa-book' }, // [æ–°å¢]
            ];

// [ä¿®æ­£] ç‚ºé¿å…éŒ¯èª¤è¿´åœˆï¼Œå°‡ defaultBanner æ”¹ç‚ºç©©å®šçš„ Unsplash é€£çµï¼Œä¸¦æ–°å¢ userBanner ä½œç‚ºåˆå§‹å€¼
const safeBanner = 'https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=2070&auto=format&fit=crop';
const userBanner = 'https://i.ibb.co/8nZ43bCk/Gemini-Generated-Image-nki8ufnki8ufnki8.png';
const bannerImage = ref(userBanner);

const handleImageError = () => {
  console.warn("User banner failed to load, switching to safe default.");
  bannerImage.value = safeBanner;
};          

            // === å€’æ•¸è¨ˆæ™‚é‚è¼¯ (æ–°å¢) ===
            const tripStartDate = new Date('2026-04-02T00:00:00');
            const daysUntilTrip = computed(() => {
                const now = new Date();
                // åªæ¯”è¼ƒæ—¥æœŸï¼Œå¿½ç•¥æ™‚é–“
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const start = new Date(tripStartDate.getFullYear(), tripStartDate.getMonth(), tripStartDate.getDate());
                
                const diffTime = start - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            });

            // === æ ¸å¿ƒä¿®æ”¹ï¼šæ—…ä¼´æˆå“¡è¨­å®š (ç§»é™¤ç¯„ä¾‹æˆå“¡Aã€B) ===
            const travelers = ref(['å…¬è²»', 'ç¿”/å›', 'å€«/æ€¡', 'ç®èŒ¹', 'åª½åª½']);
const shoppingTravelers = computed(() => ['å…¨éƒ¨', ...travelers.value.filter(t => t !== 'å…¬è²»')]);
const shoppingOwners = computed(() => travelers.value.filter(t => t !== 'å…¬è²»'));
const notebookOwners = computed(() => travelers.value.filter(t => t !== 'å…¬è²»')); // [ä¿®æ”¹] ç­†è¨˜æœ¬å°ˆç”¨æ¸…å–®ï¼Œæ’é™¤å…¬è²»

const currentShoppingFilter = ref('å…¨éƒ¨');
const currentMemberFilter = ref(null);

            // === æ ¸å¿ƒä¿®æ”¹ï¼šæ—¥æœŸè³‡æ–™ (åŒ…å«å¤šå€‹åœ°é»è¨­å®š) ===
            const days = [
                { 
                    dateStr: '2026-04-02', displayDate: '4/2', dayOfWeek: 'é€±å››', 
                    mainCity: 'å¤§é˜ªå¸‚',
                    locations: [
                        { name: 'å¤§é˜ªå¸‚', lat: 34.6937, lng: 135.5023 }
                    ]
                },
                { 
                    dateStr: '2026-04-03', displayDate: '4/3', dayOfWeek: 'é€±äº”', 
                    mainCity: 'å¥ˆè‰¯/äº¬éƒ½',
                    locations: [
                        { name: 'å¤§é˜ªå¸‚', lat: 34.6937, lng: 135.5023 },
                        { name: 'å¥ˆè‰¯å¸‚', lat: 34.6851, lng: 135.8048 },
                        { name: 'äº¬éƒ½å¸‚', lat: 35.0116, lng: 135.7681 }
                    ]
                },
                { 
                    dateStr: '2026-04-04', displayDate: '4/4', dayOfWeek: 'é€±å…­', 
                    mainCity: 'äº¬éƒ½å¸‚',
                    locations: [
                        { name: 'äº¬éƒ½å¸‚', lat: 35.0116, lng: 135.7681 },
                        { name: 'å¤§é˜ªå¸‚', lat: 34.6937, lng: 135.5023 }
                    ]
                },
                { 
                    dateStr: '2026-04-05', displayDate: '4/5', dayOfWeek: 'é€±æ—¥', 
                    mainCity: 'å¤§é˜ªå¸‚',
                    locations: [
                        { name: 'å¤§é˜ªå¸‚', lat: 34.6937, lng: 135.5023 }
                    ]
                },
                { 
                    dateStr: '2026-04-06', displayDate: '4/6', dayOfWeek: 'é€±ä¸€', 
                    mainCity: 'é—œè¥¿æ©Ÿå ´',
                    locations: [
                        { name: 'å¤§é˜ªå¸‚', lat: 34.6937, lng: 135.5023 },
                        { name: 'æ³‰ä½é‡å¸‚(æ©Ÿå ´)', lat: 34.4320, lng: 135.2304 }
                    ]
                },
            ];
            const selectedDate = ref('2026-04-02');

            // === å¤©æ°£é‚è¼¯ ===
            const isWeatherExpanded = ref(false);
            const weatherLoading = ref(true);
            const toggleWeather = () => isWeatherExpanded.value = !isWeatherExpanded.value;
            
            const weatherData = reactive({
                temp: '--', apparentTemp: '--', humidity: '--', windSpeed: '--', rain: '--', uvIndex: '--', 
                sunrise: '--:--', sunset: '--:--', description: 'è¼‰å…¥ä¸­...', icon: 'fa-solid fa-spinner', iconColor: '#ccc', city: 'å¤§é˜ªå¸‚',
                // [æ–°å¢] æœ€é«˜/æœ€ä½æº«èˆ‡ç©¿è¡£å»ºè­°é è¨­å€¼
                maxTemp: '--', minTemp: '--', clothing: 'è¼‰å…¥ä¸­...'
            });

            // è¨ˆç®—ç•¶å‰æ—¥æœŸçš„æ‰€æœ‰å¯é¸åŸå¸‚
            const currentDayCities = computed(() => {
                const day = days.find(d => d.dateStr === selectedDate.value);
                return day ? day.locations : [];
            });

            // åˆ‡æ›å¤©æ°£åŸå¸‚
            const changeWeatherCity = (city) => {
                fetchWeather(city.lat, city.lng, city.name);
            };

            const fetchWeather = async (lat, lng, cityName) => {
                weatherLoading.value = true;
                weatherData.city = cityName;
                try {
                    // [æ›´æ–°] API è«‹æ±‚ï¼šå¢åŠ  daily=temperature_2m_max,temperature_2m_min
                    const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,precipitation,weather_code,wind_speed_10m&daily=sunrise,sunset,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo`);
                    const data = await response.json();
                    
                    if (!data.current) throw new Error("No data");
                    const current = data.current;
                    const daily = data.daily;

                    weatherData.temp = Math.round(current.temperature_2m);
                    weatherData.apparentTemp = Math.round(current.apparent_temperature);
                    weatherData.humidity = current.relative_humidity_2m;
                    weatherData.windSpeed = current.wind_speed_10m;
                    weatherData.rain = current.precipitation;
                    
                    // [æ–°å¢] è™•ç†æ¯æ—¥æœ€é«˜/æœ€ä½æº«èˆ‡ç©¿è¡£å»ºè­°
                    if (daily) {
                        weatherData.maxTemp = Math.round(daily.temperature_2m_max[0]);
                        weatherData.minTemp = Math.round(daily.temperature_2m_min[0]);
                        weatherData.sunrise = daily.sunrise[0].split('T')[1];
                        weatherData.sunset = daily.sunset[0].split('T')[1];
                        
                        // ç°¡å–®çš„ç©¿è¡£å»ºè­°é‚è¼¯
                        const maxT = weatherData.maxTemp;
                        if (maxT < 15) {
                            weatherData.clothing = "å¤©æ°£å¯’å†· ğŸ§¥ å»ºè­°ç©¿è‘—åšå¤–å¥—ã€åœå·¾ï¼Œæ³¨æ„ä¿æš–ã€‚";
                        } else if (maxT < 20) {
                            weatherData.clothing = "æ—©æ™šæº«å·®å¤§ ğŸ§¥ å»ºè­°æ´‹è”¥å¼ç©¿æ­ï¼Œè–„é•·è¢–æ­é…é¢¨è¡£æˆ–å¤–å¥—ã€‚";
                        } else if (maxT < 25) {
                            weatherData.clothing = "æº«æš–èˆ’é© ğŸ‘• å¯ç©¿è–„é•·è¢–æˆ–çŸ­è¢–ï¼Œå¸¶ä»¶è–„å¤–å¥—å‚™ç”¨ã€‚";
                        } else {
                            weatherData.clothing = "å¤©æ°£ç‚ç†± â˜€ï¸ å»ºè­°ç©¿è‘—é€æ°£çŸ­è¢–ï¼Œä¸¦æ³¨æ„é˜²æ›¬è£œæ°´ã€‚";
                        }
                    }

                    const wInfo = getWeatherInfo(current.weather_code, current.is_day === 1);
                    weatherData.description = wInfo.desc;
                    weatherData.icon = wInfo.icon;
                    weatherData.iconColor = wInfo.color;
                    
                    weatherData.uvIndex = (current.is_day === 1 && current.weather_code <= 2) ? 'é«˜' : 'ä½';

                } catch (error) {
                    console.warn("Weather API access failed (likely due to network restrictions). Using fallback data.");
                    
                    // Fallback data
                    weatherData.temp = 18;
                    weatherData.apparentTemp = 16;
                    weatherData.maxTemp = 20; // æ¨¡æ“¬æ•¸æ“š
                    weatherData.minTemp = 10; // æ¨¡æ“¬æ•¸æ“š
                    weatherData.clothing = "æ—©æ™šæº«å·®å¤§ (æ¨¡æ“¬æ•¸æ“š)";
                    weatherData.humidity = 45;
                    weatherData.windSpeed = 3;
                    weatherData.rain = 0;
                    weatherData.description = "æ™´æœ— (æ¨¡æ“¬)";
                    weatherData.icon = "fa-solid fa-sun";
                    weatherData.iconColor = "#fbbf24";
                    weatherData.uvIndex = "ä¸­";
                    weatherData.sunrise = "05:42";
                    weatherData.sunset = "18:15";
                } finally {
                    setTimeout(() => { weatherLoading.value = false; }, 300);
                }
            };

            const getWeatherInfo = (code, isDay) => {
                if (code === 0) return { desc: 'æ™´æœ—', icon: isDay ? 'fa-solid fa-sun' : 'fa-solid fa-moon', color: isDay ? '#fbbf24' : '#fbbf24' };
                if (code === 1) return { desc: 'å¤§è‡´æ™´æœ—', icon: isDay ? 'fa-solid fa-cloud-sun' : 'fa-solid fa-cloud-moon', color: '#fbbf24' };
                if (code === 2) return { desc: 'å¤šé›²', icon: 'fa-solid fa-cloud', color: '#9ca3af' };
                if (code === 3) return { desc: 'é™°å¤©', icon: 'fa-solid fa-cloud', color: '#6b7280' };
                if (code >= 45 && code <= 48) return { desc: 'æœ‰éœ§', icon: 'fa-solid fa-smog', color: '#9ca3af' };
                if (code >= 51 && code <= 55) return { desc: 'æ¯›æ¯›é›¨', icon: 'fa-solid fa-cloud-rain', color: '#60a5fa' };
                if (code >= 61 && code <= 67) return { desc: 'ä¸‹é›¨', icon: 'fa-solid fa-umbrella', color: '#3b82f6' };
                if (code >= 71 && code <= 77) return { desc: 'ä¸‹é›ª', icon: 'fa-regular fa-snowflake', color: '#93c5fd' };
                if (code >= 80 && code <= 82) return { desc: 'é™£é›¨', icon: 'fa-solid fa-cloud-showers-heavy', color: '#2563eb' };
                if (code >= 95) return { desc: 'é›·é›¨', icon: 'fa-solid fa-bolt', color: '#eab308' };
                return { desc: 'æœªçŸ¥', icon: 'fa-solid fa-circle-question', color: '#ccc' };
            };

            watch(selectedDate, (newDate) => {
                const dayInfo = days.find(d => d.dateStr === newDate);
                if (dayInfo && dayInfo.locations.length > 0) {
                    changeWeatherCity(dayInfo.locations[0]);
                }
            });

            onMounted(() => {
                const dayInfo = days.find(d => d.dateStr === selectedDate.value);
                if (dayInfo && dayInfo.locations.length > 0) {
                    changeWeatherCity(dayInfo.locations[0]);
                }
                fetchExchangeRate(); // [æ–°å¢] è¼‰å…¥åŒ¯ç‡
            });

            // === å…¶ä»–åŠŸèƒ½ä¿æŒä¸è®Š ===
            // 4/2 & 4/3 çš„è©³ç´°è¡Œç¨‹è³‡æ–™
            const fullItineraryData = [
                // === 4/2 (å››) ===
                {
                    id: 1,
                    date: '2026-04-02',
                    category: 'flight',
                    name: 'èˆªç­ IT-284 KHH->KIX',
                    time: '07:00',
                    travelTime: 0,
                    transportType: 'flight',
                    note: 'èµ·é£› 07:00 / æŠµé” 10:55 (é è¨ˆå‡ºé—œ 11:30)'
                },
                {
                    id: 2,
                    date: '2026-04-02',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šé—œè¥¿æ©Ÿå ´ â†’ é›£æ³¢',
                    time: '11:40',
                    travelTime: 45,
                    transportType: 'transit',
                    note: 'å·²äº‹å…ˆè³¼ç¥¨',
                    description: 'ğŸ“ è·¯ç·šï¼šå—æµ·é›»éµç©ºæ¸¯æ€¥è¡Œ (Nankai Airport Exp.)\nğŸš‰ å€é–“ï¼šé—œè¥¿æ©Ÿå ´ç«™ (Kansai Airport) â†’ å—æµ·é›£æ³¢ç«™ (Namba)\nğŸ’¡ æç¤ºï¼šå‡ºç«™å¾Œä¾æŒ‡ç¤ºå‰å¾€åœ°éµå¾¡å ‚ç­‹ç·šã€‚'
                },
                {
                    id: 3,
                    date: '2026-04-02',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šé›£æ³¢ â†’ æœ¬ç”º (é£¯åº—)',
                    time: '12:40',
                    travelTime: 15,
                    transportType: 'transit',
                    note: 'è½‰ä¹˜å¾¡å ‚ç­‹ç·š (ç´…ç·š)',
                    description: 'ğŸš‰ å€é–“ï¼šé›£æ³¢ç«™ (M20) â†’ æœ¬ç”ºç«™ (M18)\nğŸš¶ æ­¥è¡Œï¼šç”± 11 è™Ÿæˆ– 12 è™Ÿå‡ºå£å‡ºç«™ï¼Œæ­¥è¡Œç´„ 3-5 åˆ†é˜æŠµé”é£¯åº—ã€‚'
                },
                {
                    id: 4,
                    date: '2026-04-02',
                    category: 'accommodation',
                    name: 'æ±æ€¥ Stay å¤§é˜ªæœ¬ç”º',
                    time: '13:00',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'å…ˆå¯„æ”¾è¡Œæ',
                    description: 'å…ˆåœ¨å¤§å»³å¯„æ”¾è¡Œæï¼Œè¼•è£å‡ºç™¼å»å¤§é˜ªåŸï¼'
                },
                {
                    id: 5,
                    date: '2026-04-02',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šæœ¬ç”º â†’ å¤§é˜ªåŸå…¬åœ’',
                    time: '13:30',
                    travelTime: 20,
                    transportType: 'transit',
                    note: 'æ­ä¹˜ä¸­å¤®ç·š (ç¶ ç·š)',
                    description: 'ğŸš‰ å€é–“ï¼šæœ¬ç”ºç«™ (C16) â†’ è°·ç”ºå››ä¸ç›®ç«™ (C18)\nğŸš¶ æ­¥è¡Œï¼šå¾ 9 è™Ÿå‡ºå£å‡ºä¾†ï¼Œæ­¥è¡Œå‰å¾€å¤§é˜ªåŸå¤§æ‰‹é–€æ–¹å‘ï¼Œæ²¿é€”å¯è¦‹è­·åŸæ²³èˆ‡æ«»èŠ±ã€‚'
                },
                {
                    id: 6,
                    date: '2026-04-02',
                    category: 'attraction',
                    name: 'å¤§é˜ªåŸå…¬åœ’ & å¤©å®ˆé–£',
                    time: '14:00',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'ğŸŒ¸ æ«»èŠ±ç™¾é¸åæ‰€',
                    image: 'https://images.unsplash.com/photo-1590559899731-a38283956c8c?w=150&h=150&fit=crop',
                    openHours: '09:00 - 17:00 (æœ€å¾Œå…¥å ´ 16:30)',
                    ticket: 'å¤©å®ˆé–£ Â¥600 / è¥¿ä¹‹ä¸¸åº­åœ’ Â¥200',
                    description: 'å¤§é˜ªçš„åœ°æ¨™ï¼Œåœ’å…§ç¨®æ¤ç´„3000æ ªæ«»èŠ±ã€‚æ¨è–¦å‰å¾€ã€Œè¥¿ä¹‹ä¸¸åº­åœ’ã€è³æ«»ï¼Œé€™è£¡ä»¥æŸ“äº•å‰é‡æ«»ç‚ºä¸»ï¼Œèƒ½æ‹åˆ°å¤©å®ˆé–£èˆ‡æ«»èŠ±åŒæ¡†çš„çµ•ç¾ç•«é¢ã€‚å¤©å®ˆé–£å…§å±•ç¤ºè±è‡£ç§€å‰çš„æ­·å²æ–‡ç‰©ï¼Œ8æ¨“å±•æœ›å°å¯ä¿¯ç°å¤§é˜ªå¸‚æ™¯ã€‚'
                },
                {
                    id: 7,
                    date: '2026-04-02',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šå¤§é˜ªåŸ â†’ é£¯åº—',
                    time: '16:30',
                    travelTime: 20,
                    transportType: 'transit',
                    note: 'å›é£¯åº—è¾¦ç†å…¥ä½',
                    description: 'ğŸš‰ å€é–“ï¼šè°·ç”ºå››ä¸ç›®ç«™ (C18) â†’ æœ¬ç”ºç«™ (C16) (æ­ä¹˜ä¸­å¤®ç·š)\nè¿”å›é£¯åº—é ˜å–è¡Œæä¸¦è¾¦ç† Check-inã€‚'
                },
                {
                    id: 8,
                    date: '2026-04-02',
                    category: 'accommodation',
                    name: 'é£¯åº— Check-in & ä¼‘æ¯',
                    time: '17:00',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'ç¨ä½œæ•´ç†èˆ‡ä¼‘æ¯',
                    description: 'è¾¦ç†å…¥ä½æ‰‹çºŒï¼Œé€²æˆ¿æ•´ç†ä¸€ä¸‹è¡Œæï¼Œè£œå¦æˆ–ä¼‘æ¯ç‰‡åˆ»ï¼Œæº–å‚™æ™šä¸Šå»é€›è¡—ï¼'
                },
                {
                    id: 9,
                    date: '2026-04-02',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šé£¯åº— â†’ å¿ƒé½‹æ©‹',
                    time: '17:45',
                    travelTime: 15,
                    transportType: 'walk',
                    note: 'æ­¥è¡Œæˆ–æ­åœ°éµä¸€ç«™',
                    description: 'å¾æœ¬ç”ºæ…¢æ…¢æ•£æ­¥è‡³å¿ƒé½‹æ©‹å•†åº—è¡—(ç´„10-15åˆ†)ï¼Œæˆ–è€…æ­ä¹˜å¾¡å ‚ç­‹ç·šä¸€ç«™ (æœ¬ç”ºâ†’å¿ƒé½‹æ©‹)ã€‚'
                },
                {
                    id: 10,
                    date: '2026-04-02',
                    category: 'shopping',
                    name: 'å¿ƒé½‹æ©‹ & é“é “å € æ™šé¤',
                    time: '18:00',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'é€›è¡—ã€åƒæ™šé¤ã€è·‘è·‘äººçœ‹æ¿',
                    openHours: 'ä¾åº—å®¶ (ç´„è‡³ 20:00/21:00)',
                    description: 'å¤§é˜ªæœ€ç†±é¬§çš„è³¼ç‰©å€ã€‚å¿ƒé½‹æ©‹æœ‰å¤§ä¸¸ç™¾è²¨ã€Uniqloæ——è‰¦åº—ã€è—¥å¦åº—ã€‚æ™šé¤å»ºè­°åˆ°é“é “å €å“åšç« é­šç‡’ã€æ‹‰éºµ (ä¸€è˜­/é‡‘é¾) æˆ–å¤§é˜ªç‡’ã€‚åˆ¥å¿˜äº†åœ¨æˆæ©‹è·Ÿå›ºåŠ›æœè·‘è·‘äººåˆç…§ï¼'
                },
                {
                    id: 11,
                    date: '2026-04-02',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šå¿ƒé½‹æ©‹ â†’ é£¯åº—',
                    time: '21:00',
                    travelTime: 15,
                    transportType: 'walk',
                    note: 'æ­¥è¡Œæˆ–æ­åœ°éµ',
                    description: 'åƒé£½å–è¶³å¾Œï¼Œæ•£æ­¥å›é£¯åº—æ¶ˆåŒ–ä¸€ä¸‹ï¼ŒçµæŸç¬¬ä¸€å¤©çš„è¡Œç¨‹ã€‚'
                },
                
                // === 4/3 (äº”) å¥ˆè‰¯ & ä¼è¦‹ç¨»è· ===
                {
                    id: 201,
                    date: '2026-04-03',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šé£¯åº— â†’ å¥ˆè‰¯',
                    time: '08:00',
                    travelTime: 60,
                    transportType: 'transit',
                    note: 'åœ°éµè½‰è¿‘éµ',
                    description: 'ğŸ“ è·¯ç·šï¼š\n1. é£¯åº—æ­¥è¡Œè‡³ æœ¬ç”ºç«™\n2. æ­ä¹˜åœ°éµå¾¡å ‚ç­‹ç·šè‡³ é›£æ³¢ç«™ (M20)\n3. å‡ºç«™æ­¥è¡Œè‡³ è¿‘éµå¤§é˜ªé›£æ³¢ç«™\n4. æ­ä¹˜è¿‘éµå¥ˆè‰¯ç·š (å¿«é€Ÿæ€¥è¡Œ) è‡³ è¿‘éµå¥ˆè‰¯ç«™\nğŸ’¡ æç¤ºï¼šæ­ä¹˜å¿«é€Ÿæ€¥è¡Œç´„ 40 åˆ†é˜ï¼Œæ¯”æ™®é€šè»Šå¿«å¾ˆå¤šã€‚'
                },
                {
                    id: 202,
                    date: '2026-04-03',
                    category: 'attraction',
                    name: 'å¥ˆè‰¯å…¬åœ’ (æ¢…èŠ±é¹¿å…¬åœ’)',
                    time: '09:10',
                    travelTime: 10,
                    transportType: 'walk',
                    image: 'https://images.unsplash.com/photo-1599816773809-5a6792d47a46?w=150&h=150&fit=crop',
                    note: 'è²·é¹¿ä»™è²å°å¿ƒè¢«åœæ”»',
                    description: 'å¾è¿‘éµå¥ˆè‰¯ç«™ 2 è™Ÿå‡ºå£å‡ºä¾†ï¼Œæ²¿è‘—ç™»å¤§è·¯å¾€æ±èµ°å³é”ã€‚æ²¿é€”å°±æœƒçœ‹åˆ°å¾ˆå¤šé¹¿ã€‚è«‹æ³¨æ„æ‰‹ä¸Šçš„åœ°åœ–æˆ–ç´™å¼µï¼Œé¹¿å¯èƒ½æœƒå’¬èµ°ã€‚'
                },
                {
                    id: 203,
                    date: '2026-04-03',
                    category: 'attraction',
                    name: 'æ±å¤§å¯º (å¤§ä½›æ®¿)',
                    time: '10:00',
                    travelTime: 15,
                    transportType: 'walk',
                    note: 'ä¸–ç•Œæœ€å¤§æœ¨é€ å»ºç¯‰',
                    image: 'https://images.unsplash.com/photo-1624253321171-1be53e12f5f4?w=150&h=150&fit=crop',
                    ticket: 'Â¥600',
                    openHours: '07:30 - 17:30',
                    description: 'ç©¿è¶Šå·¨å¤§çš„å—å¤§é–€ï¼ˆæœ‰é‡‘å‰›åŠ›å£«åƒï¼‰ï¼Œåƒè§€å¤§ä½›æ®¿å…§çš„ç›§èˆé‚£ä½›ã€‚å¦‚æœäººä¸å¤šï¼Œå¯ä»¥æŒ‘æˆ°é‘½ã€Œå¤§ä½›é¼»å­”ã€æŸ±å­æ´ï¼Œè½èªªèƒ½ä¿å¹³å®‰ã€‚'
                },
                {
                    id: 204,
                    date: '2026-04-03',
                    category: 'attraction',
                    name: 'æ˜¥æ—¥å¤§ç¤¾',
                    time: '11:30',
                    travelTime: 20,
                    transportType: 'walk',
                    note: 'åƒé“çŸ³ç‡ˆç± ',
                    image: 'https://images.unsplash.com/photo-1549646461-a47738363b7e?w=150&h=150&fit=crop',
                    description: 'æ²¿è‘—æ£®æ—åƒé“å‰å¾€ï¼Œé€™è£¡æ°£æ°›æ¯”è¼ƒå¹½éœã€‚ä»¥æ•¸åƒåº§çŸ³ç‡ˆç± å’ŒåŠç‡ˆç± èåã€‚å¦‚æœèµ°ç´¯äº†ï¼Œå¯ä»¥åœ¨åƒé“å…¥å£é™„è¿‘çš„èŒ¶å±‹ä¼‘æ¯åƒé»æ±è¥¿ã€‚'
                },
                {
                    id: 205,
                    date: '2026-04-03',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šæ˜¥æ—¥å¤§ç¤¾ â†’ JR å¥ˆè‰¯ç«™',
                    time: '13:00',
                    travelTime: 25,
                    transportType: 'transit',
                    note: 'æ­ä¹˜å·´å£«',
                    description: 'æ­¥è¡Œè‡³ã€Œæ˜¥æ—¥å¤§ç¤¾æœ¬æ®¿ã€å·´å£«ç«™ï¼Œæ­ä¹˜å¥ˆè‰¯äº¤é€šå·´å£« (70/97/98è™Ÿ) å‰å¾€ JR å¥ˆè‰¯ç«™ (ç´„ 15-20 åˆ†é˜)ã€‚\nğŸ’¡ è‹¥æ­¥è¡Œéœ€ç´„ 30-40 åˆ†é˜ï¼Œå»ºè­°æ­è»Šä¿ç•™é«”åŠ›ã€‚'
                },
                {
                    id: 206,
                    date: '2026-04-03',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šJR å¥ˆè‰¯ â†’ JR ç¨»è·',
                    time: '13:30',
                    travelTime: 35,
                    transportType: 'transit',
                    note: 'æ­ä¹˜ JR å¥ˆè‰¯ç·š',
                    description: 'ğŸš‰ å€é–“ï¼šJR å¥ˆè‰¯ç«™ â†’ JR ç¨»è·ç«™\nğŸ’¡ æ³¨æ„ï¼šè«‹æ­ä¹˜ã€Œæ™®é€šã€åˆ—è»Š (Miyakoji Rapid ä¸åœç¨»è·)ï¼Œæˆ–è€…æ­å¿«é€Ÿåˆ°å®‡æ²»/æ±ç¦å¯ºå†è½‰æ™®é€šè»Šã€‚ç¨»è·ç«™å‡ºç«™å³æ˜¯ç¥ç¤¾å…¥å£ã€‚'
                },
                {
                    id: 207,
                    date: '2026-04-03',
                    category: 'attraction',
                    name: 'ä¼è¦‹ç¨»è·å¤§ç¤¾',
                    time: '14:10',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'åƒæœ¬é³¥å±…',
                    image: 'https://images.unsplash.com/photo-1478436127897-769e1b3f0f36?w=150&h=150&fit=crop',
                    description: 'å¿…æ‹åƒæœ¬é³¥å±…ï¼å»ºè­°å¾€å±±ä¸Šèµ°ä¸€æ®µï¼Œäººæ½®æœƒè®Šå°‘ï¼Œæ¯”è¼ƒå¥½æ‹ç…§ã€‚é€™è£¡ç‹ç‹¸æ˜¯ç¥çš„ä½¿è€…ï¼Œç¹ªé¦¬ä¹Ÿæ˜¯ç‹ç‹¸å½¢ç‹€çš„å–”ã€‚'
                },
                {
                    id: 208,
                    date: '2026-04-03',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šç¨»è· â†’ é£¯åº— (ç¶“äº¬éƒ½/æ–°å¤§é˜ª)',
                    time: '16:30',
                    travelTime: 60,
                    transportType: 'transit',
                    note: 'JR è½‰ åœ°éµ',
                    description: '1. JR ç¨»è· â†’ JR äº¬éƒ½ (å¥ˆè‰¯ç·š)\n2. JR äº¬éƒ½ â†’ JR æ–°å¤§é˜ª (JRäº¬éƒ½ç·š/æ–°å¿«é€Ÿ)\n3. JR æ–°å¤§é˜ª â†’ åœ°éµ æ–°å¤§é˜ª (è½‰ä¹˜å¾¡å ‚ç­‹ç·š)\n4. åœ°éµ æ–°å¤§é˜ª â†’ æœ¬ç”º (M18)\nğŸ’¡ é€™æ˜¯åˆ©ç”¨ JR PASS æˆ–å–®ç¨‹ç¥¨çš„å¿«é€Ÿèµ°æ³•ã€‚'
                },
                {
                    id: 209,
                    date: '2026-04-03',
                    category: 'shopping',
                    name: 'æ™šä¸Šè‡ªç”±é€›è¡—',
                    time: '18:30',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'è‡ªç”±æ´»å‹•',
                    description: 'å›åˆ°æœ¬ç”º/å¿ƒé½‹æ©‹å€åŸŸã€‚å¯ä»¥å„è‡ªå»è—¥å¦åº—è£œè²¨ï¼Œæˆ–æ˜¯å»é›£æ³¢ Parksã€é«˜å³¶å±‹é€›è¡—ã€‚æ™šé¤å¯ç›¸ç´„åƒç‡’è‚‰æˆ–å„è‡ªè¦“é£Ÿã€‚'
                },

                // === 4/4 (å…­) äº¬éƒ½æ¸…æ°´å¯º & ç¥‡åœ’ ===
                {
                    id: 301,
                    date: '2026-04-04',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šé£¯åº— â†’ äº¬éƒ½è»Šç«™',
                    time: '08:00',
                    travelTime: 50,
                    transportType: 'transit',
                    note: 'åœ°éµè½‰ JR (ç¶“æ–°å¤§é˜ª)',
                    description: 'ğŸ“ è·¯ç·šï¼š\n1. é£¯åº—æ­¥è¡Œè‡³ æœ¬ç”ºç«™\n2. æ­ä¹˜åœ°éµå¾¡å ‚ç­‹ç·šè‡³ æ–°å¤§é˜ªç«™ (M13)\n3. ç«™å…§è½‰ä¹˜ JR äº¬éƒ½ç·š (æ–°å¿«é€Ÿ) è‡³ JR äº¬éƒ½ç«™\nğŸ’¡ æç¤ºï¼šåœ¨æ–°å¤§é˜ªè½‰ä¹˜æ¯”åœ¨æ¢…ç”°(å¤§é˜ªç«™)ç°¡å–®è¨±å¤šï¼Œè«‹æ­ä¹˜ã€Œæ–°å¿«é€Ÿã€åˆ—è»Šï¼Œç´„ 25 åˆ†é˜å³å¯æŠµé”äº¬éƒ½ã€‚'
                },
                {
                    id: 302,
                    date: '2026-04-04',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šäº¬éƒ½è»Šç«™ â†’ æ¸…æ°´å¯º',
                    time: '09:00',
                    travelTime: 30,
                    transportType: 'transit',
                    note: 'è½‰ä¹˜äº¬éƒ½å¸‚å·´å£«',
                    description: 'å‰å¾€äº¬éƒ½è»Šç«™å‰çš„å·´å£«ç¸½ç«™ (D1 æˆ– D2 ä¹˜è»Šè™•)ï¼Œæ­ä¹˜ 206 è™Ÿæˆ– 100 è™Ÿ (æ´›å·´å£«) ï¼Œåœ¨ã€Œäº”æ¢å‚ã€æˆ–ã€Œæ¸…æ°´é“ã€ä¸‹è»Šï¼Œæ­¥è¡Œä¸Šå¡ç´„ 10-15 åˆ†é˜æŠµé”ä»ç‹é–€ã€‚'
                },
                {
                    id: 303,
                    date: '2026-04-04',
                    category: 'attraction',
                    name: 'æ¸…æ°´å¯º',
                    time: '09:40',
                    travelTime: 15,
                    transportType: 'walk',
                    note: 'æ¸…æ°´èˆå°ã€éŸ³ç¾½ç€‘å¸ƒ',
                    image: 'https://images.unsplash.com/photo-1549444318-7b96620577d6?w=150&h=150&fit=crop',
                    ticket: 'Â¥400',
                    openHours: '06:00 - 18:00',
                    description: 'äº¬éƒ½æœ€è‘—åçš„å¤è€å¯ºé™¢ï¼Œå¿…çœ‹æ‡¸ç©ºçš„ã€Œæ¸…æ°´èˆå°ã€ã€‚åƒæ‹œå¾Œå¯å»ã€Œåœ°ä¸»ç¥ç¤¾ã€æ±‚å§»ç·£ (è‹¥æ•´ä¿®ä¸­å‰‡ç•¥é)ï¼Œæœ€å¾Œåˆ¥å¿˜äº†åœ¨ã€ŒéŸ³ç¾½ç€‘å¸ƒã€æ’éšŠå–æ°´ç¥ˆç¦ï¼ˆåˆ†åˆ¥ä»£è¡¨å­¸æ¥­ã€æˆ€æ„›ã€é•·å£½ï¼Œåªèƒ½é¸ä¸€é“å–å–”ï¼‰ã€‚'
                },
                {
                    id: 304,
                    date: '2026-04-04',
                    category: 'attraction',
                    name: 'æ•£æ­¥ï¼šäºŒä¸‰å¹´å‚ & å¯§å¯§ä¹‹é“',
                    time: '11:30',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'å¤è‰²å¤é¦™è€è¡—',
                    description: 'é †è‘—æ¸…æ°´å¯ºèµ°ä¸‹ä¾†ï¼Œæœƒç¶“éä¸‰å¹´å‚ï¼ˆç”¢å¯§å‚ï¼‰å’ŒäºŒå¹´å‚ã€‚é€™è£¡æœ‰éå¸¸å¤šæ—¥å¼é›œè²¨èˆ‡é»å¿ƒåº—ã€‚é€”ä¸­æ¨è–¦å»ã€Œæ˜Ÿå·´å…‹äº¬éƒ½äºŒå¯§å‚é›…ç¥¥èŒ¶å±‹åº—ã€æ‹ç…§ï¼Œé€™æ˜¯å…¨çƒå”¯ä¸€è¨­åœ¨ç™¾å¹´ç”ºå®¶è£¡çš„æ¦»æ¦»ç±³æ˜Ÿå·´å…‹ã€‚æ¥è‘—å‰å¾€é«˜å°å¯ºæ—çš„å¯§å¯§ä¹‹é“ã€‚'
                },
                {
                    id: 305,
                    date: '2026-04-04',
                    category: 'attraction',
                    name: 'ç¥‡åœ’ & èŠ±è¦‹å°è·¯',
                    time: '13:00',
                    travelTime: 15,
                    transportType: 'walk',
                    image: 'https://images.unsplash.com/photo-1587399434857-e6f7734a36f5?w=150&h=150&fit=crop',
                    note: 'è—å¦“èˆ‡èŒ¶å±‹æ–‡åŒ–',
                    description: 'æ²¿è‘—å¯§å¯§ä¹‹é“èµ°åˆ°å…«å‚ç¥ç¤¾ï¼Œå†å‰å¾€ç¥‡åœ’å€åŸŸã€‚èŠ±è¦‹å°è·¯å…©æ—æ˜¯ä¿å­˜è‰¯å¥½çš„å‚³çµ±èŒ¶å±‹ï¼Œé‹æ°£å¥½å¯èƒ½æœƒçœ‹åˆ°è—å¦“æˆ–èˆå¦“ç¶“éï¼ˆè«‹å‹¿è§¸ç¢°æˆ–é˜»æ“‹æ‹ç…§ï¼‰ã€‚åˆé¤å»ºè­°åœ¨æ­¤å€åŸŸæˆ–æ²³åŸç”ºè§£æ±ºã€‚'
                },
                {
                    id: 306,
                    date: '2026-04-04',
                    category: 'attraction',
                    name: 'é´¨å· & æ²³åŸç”ºå•†åº—è¡—',
                    time: '15:00',
                    travelTime: 10,
                    transportType: 'walk',
                    note: 'æ²³å²¸æ•£æ­¥èˆ‡é€›è¡—',
                    description: 'å¾ç¥‡åœ’è·¨éå››æ¢å¤§æ©‹å°±æ˜¯é´¨å·ï¼Œé©åˆåœ¨æ²³å ¤é‚Šåè‘—ä¼‘æ¯å¹é¢¨ï¼Œæ¬£è³æ²³æ™¯ã€‚éæ©‹å¾Œå³é€²å…¥æ²³åŸç”ºå•†åœˆï¼Œé€™è£¡æœ‰é«˜å³¶å±‹ã€Disney Storeã€å„ç§è—¥å¦èˆ‡æœé£¾åº—ï¼Œéå¸¸å¥½é€›ã€‚'
                },
                {
                    id: 307,
                    date: '2026-04-04',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šæ²³åŸç”º â†’ äº¬éƒ½è»Šç«™',
                    time: '18:00',
                    travelTime: 20,
                    transportType: 'transit',
                    note: 'åœ°éµæˆ–å·´å£«',
                    description: 'åœ¨å››æ¢æ²³åŸç”ºæ­ä¹˜å·´å£«å›äº¬éƒ½è»Šç«™ï¼Œæˆ–è€…èµ°è‡³åœ°éµå››æ¢ç«™é»æ­ä¹˜çƒä¸¸ç·šè‡³äº¬éƒ½ç«™ã€‚æº–å‚™æ­ JR å›å¤§é˜ªã€‚'
                },
                {
                    id: 308,
                    date: '2026-04-04',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šäº¬éƒ½è»Šç«™ â†’ é£¯åº—',
                    time: '18:30',
                    travelTime: 50,
                    transportType: 'transit',
                    note: 'JR è½‰ åœ°éµ (ç¶“æ–°å¤§é˜ª)',
                    description: 'ğŸ“ è·¯ç·šï¼š\n1. JR äº¬éƒ½ç«™ (æ­ä¹˜ JR äº¬éƒ½ç·š/æ–°å¿«é€Ÿ) â†’ JR æ–°å¤§é˜ªç«™ (ç´„ 24 åˆ†)\n2. ç«™å…§è½‰ä¹˜åœ°éµå¾¡å ‚ç­‹ç·š (æ–°å¤§é˜ª M13 â†’ æœ¬ç”º M18)\n3. æ­¥è¡Œå›é£¯åº—\nğŸ’¡ é€™æ˜¯æœ€å¿«ä¹Ÿæœ€å–®ç´”çš„è·¯ç·šã€‚æ™šé¤å»ºè­°åœ¨äº¬éƒ½è»Šç«™æ‹‰éºµå°è·¯è§£æ±ºï¼Œæˆ–è²·ä¾¿ç•¶å›é£¯åº—äº«ç”¨ã€‚'
                },
                {
                    id: 310,
                    date: '2026-04-04',
                    category: 'other',
                    name: 'é£¯åº—è‡ªç”±æ´»å‹•',
                    time: '20:00',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'ä¼‘æ¯æˆ–æ•´ç†è¡Œæ',
                    description: 'ç¶“éä¸€æ•´å¤©äº¬éƒ½èµ°è·¯è¡Œç¨‹ï¼Œè…¿æ‡‰è©²å¾ˆé…¸äº†ï¼Œå»ºè­°æ—©é»ä¼‘æ¯ï¼Œæˆ–æ˜¯åœ¨é£¯åº—é™„è¿‘è¶…å•†è²·é»å®µå¤œã€‚'
                },

                // === 4/5 (æ—¥) æµ·éŠé¤¨ & å¤©ç‹å¯ºé˜¿å€é‡ ===
                {
                    id: 401,
                    date: '2026-04-05',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šé£¯åº— â†’ æµ·éŠé¤¨',
                    time: '09:00',
                    travelTime: 20,
                    transportType: 'transit',
                    note: 'æ­ä¹˜ä¸­å¤®ç·š (ç¶ ç·š)',
                    description: 'ğŸ“ è·¯ç·šï¼š\n1. é£¯åº—æ­¥è¡Œè‡³ æœ¬ç”ºç«™\n2. æ­ä¹˜åœ°éµä¸­å¤®ç·š (å¾€å®‡å®™å»£å ´æ–¹å‘) è‡³ å¤§é˜ªæ¸¯ç«™ (C11)\n3. 1è™Ÿæˆ–2è™Ÿå‡ºå£å‡ºç«™ï¼Œæ­¥è¡Œç´„ 5-10 åˆ†é˜æŠµé”ã€‚'
                },
                {
                    id: 402,
                    date: '2026-04-05',
                    category: 'attraction',
                    name: 'æµ·éŠé¤¨',
                    time: '09:30',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'ä¸–ç•Œæœ€å¤§ç´šæ°´æ—é¤¨',
                    image: 'https://images.unsplash.com/photo-1585257989998-d0e80a04918e?w=150&h=150&fit=crop',
                    ticket: 'Â¥2,700',
                    openHours: '09:30 - 20:00',
                    description: 'å¿…çœ‹å·¨å¤§çš„ã€Œå¤ªå¹³æ´‹ã€æ°´æ§½èˆ‡é®é¤¨ä¹‹å¯¶â€”â€”é¯¨é¯Šã€‚é¤¨å…§è¨­è¨ˆæ˜¯å¾8æ¨“èºæ—‹ç‹€å¾€ä¸‹åƒè§€ï¼Œæ¨¡æ“¬å¾æµ·é¢æ½›å…¥æ·±æµ·çš„éç¨‹ã€‚æ—é‚Šçš„å¤©ä¿å±±æ‘©å¤©è¼ªä¹Ÿå¯ä»¥é †é“çœ‹çœ‹ã€‚'
                },
                {
                    id: 403,
                    date: '2026-04-05',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šæµ·éŠé¤¨ â†’ é€šå¤©é–£',
                    time: '12:00',
                    travelTime: 30,
                    transportType: 'transit',
                    note: 'ä¸­å¤®ç·šè½‰å ºç­‹ç·š',
                    description: '1. å¤§é˜ªæ¸¯ç«™ (ä¸­å¤®ç·š) â†’ å ºç­‹æœ¬ç”ºç«™ (C17)\n2. è½‰ä¹˜å ºç­‹ç·š (å’–å•¡è‰²ç·š) â†’ æƒ ç¾é ˆç”ºç«™ (K18)\n3. 3è™Ÿå‡ºå£å‡ºç«™ï¼Œé€šå¤©é–£å°±åœ¨çœ¼å‰ã€‚'
                },
                {
                    id: 404,
                    date: '2026-04-05',
                    category: 'attraction',
                    name: 'é€šå¤©é–£ & æ–°ä¸–ç•Œ',
                    time: '12:40',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'å¤§é˜ªæ‡·èˆŠåœ°æ¨™',
                    image: 'https://images.unsplash.com/photo-1595460592923-a5c92e9d29d3?w=150&h=150&fit=crop',
                    description: 'é€™è£¡å……æ»¿æ˜­å’Œæ™‚ä»£çš„æ‡·èˆŠæ°›åœï¼Œå·¨å¤§çš„æ²³è±šæ‹›ç‰Œæ˜¯å¿…æ‹æ™¯é»ã€‚å¯ä»¥ä¸Šé€šå¤©é–£å±•æœ›å°æ‘¸æ‘¸Billikenç¥åƒçš„è…³åº•æ±‚å¥½é‹ã€‚'
                },
                {
                    id: 405,
                    date: '2026-04-05',
                    category: 'food',
                    name: 'åˆé¤ï¼šå…ƒç¥–ç‚¸ä¸²',
                    time: '13:00',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'ç¦æ­¢äºŒæ¬¡æ²¾é†¬',
                    description: 'åœ¨æ–°ä¸–ç•Œå•†åº—è¡—äº«ç”¨å¤§é˜ªåç‰©ã€Œç‚¸ä¸² (Kushikatsu)ã€ã€‚æ¨è–¦ã€Œé”æ‘© (Daruma)ã€æˆ–ã€Œå…«é‡å‹ã€ã€‚è¨˜å¾—é†¬æ±æ˜¯å…±ç”¨çš„ï¼Œå’¬éå¾Œçµ•å°ä¸èƒ½å†æ²¾å–”ï¼'
                },
                {
                    id: 406,
                    date: '2026-04-05',
                    category: 'attraction',
                    name: 'å¤©ç‹å¯ºå‹•ç‰©åœ’',
                    time: '14:30',
                    travelTime: 10,
                    transportType: 'walk',
                    note: 'ç™¾å¹´å‹•ç‰©åœ’',
                    ticket: 'Â¥500',
                    openHours: '09:30 - 17:00',
                    description: 'å¾æ–°ä¸–ç•Œæ­¥è¡Œå³å¯æŠµé”ã€Œæ–°ä¸–ç•Œå¤§é–€ã€ã€‚åœ’å€å…§æœ‰æ¨¡æ“¬éæ´²ç†±å¸¶è‰åŸçš„ç”Ÿæ…‹å±•ç¤ºå€ï¼Œèƒ½è¿‘è·é›¢è§€å¯Ÿæ²³é¦¬ã€ç…å­ç­‰å‹•ç‰©ã€‚'
                },
                {
                    id: 407,
                    date: '2026-04-05',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šå‹•ç‰©åœ’ â†’ é˜¿å€é‡',
                    time: '16:30',
                    travelTime: 15,
                    transportType: 'walk',
                    note: 'ç©¿è¶Šå¤©ç‹å¯ºå…¬åœ’',
                    description: 'å¾å‹•ç‰©åœ’å‡ºä¾†ï¼Œç©¿è¶Šå¯¬é—Šæ¼‚äº®çš„ã€Œå¤©ç‹å¯ºå…¬åœ’ (Ten-Shiba)ã€è‰çš®å€ï¼Œå‰æ–¹æœ€é«˜çš„æ‘©å¤©å¤§æ¨“å°±æ˜¯é˜¿å€é‡ HARUKASã€‚'
                },
                {
                    id: 408,
                    date: '2026-04-05',
                    category: 'attraction',
                    name: 'é˜¿å€é‡ HARUKAS 300',
                    time: '17:00',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'çµ•ç¾æ—¥è½èˆ‡å¤œæ™¯',
                    image: 'https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=150&h=150&fit=crop',
                    ticket: 'Â¥1,800',
                    openHours: '09:00 - 22:00',
                    description: 'ç™»ä¸Š 60 æ¨“å±•æœ›å°ï¼Œ360 åº¦ä¿¯ç°å¤§é˜ªå…¨æ™¯ã€‚å»ºè­°åœ¨æ—¥è½å‰æŠµé”ï¼Œå¯ä»¥ä¸€æ¬¡æ¬£è³å¤•é™½èˆ‡ç™¾è¬å¤œæ™¯ã€‚æ¨“ä¸‹çš„è¿‘éµç™¾è²¨ä¹Ÿå¾ˆå¥½é€›ï¼Œç”œé»ä¼´æ‰‹ç¦®è±å¯Œã€‚'
                },
                {
                    id: 409,
                    date: '2026-04-05',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šå¤©ç‹å¯º â†’ é£¯åº—',
                    time: '19:30',
                    travelTime: 15,
                    transportType: 'transit',
                    note: 'å¾¡å ‚ç­‹ç·šç›´é”',
                    description: 'å¾å¤©ç‹å¯ºç«™ (M23) æ­ä¹˜å¾¡å ‚ç­‹ç·šï¼Œç›´é” æœ¬ç”ºç«™ (M18)ã€‚'
                },
                {
                    id: 410,
                    date: '2026-04-05',
                    category: 'other',
                    name: 'å›é£¯åº—ä¼‘æ¯',
                    time: '20:00',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'æ•´ç†æˆ°åˆ©å“',
                    description: 'æœ€å¾Œä¸€æ™šäº†ï¼Œè¨˜å¾—æ•´ç†è¡Œæï¼Œç¢ºèªä¼´æ‰‹ç¦®æ˜¯å¦è²·é½Šï¼Œæ˜å¤©å°±è¦å›ç¨‹å›‰ã€‚'
                },

                // === 4/6 (ä¸€) å›ç¨‹ ===
                {
                    id: 501,
                    date: '2026-04-06',
                    category: 'transport',
                    name: 'ç§»å‹•ï¼šé£¯åº— â†’ é—œè¥¿æ©Ÿå ´',
                    time: '08:30',
                    travelTime: 60,
                    transportType: 'transit',
                    note: 'åœ°éµè½‰å—æµ·é›»éµ',
                    description: '1. åœ°éµå¾¡å ‚ç­‹ç·šï¼šæœ¬ç”º (M18) â†’ é›£æ³¢ (M20)\n2. å—æµ·é›»éµï¼šé›£æ³¢ â†’ é—œè¥¿æ©Ÿå ´ (æ­ä¹˜ç©ºæ¸¯æ€¥è¡Œæˆ– Rapi:t)\nğŸ’¡ é›–ç„¶ç­æ©Ÿæ˜¯ 12:00ï¼Œä½†å»ºè­° 10:00 å‰æŠµé”æ©Ÿå ´æ¯”è¼ƒå……è£•ã€‚'
                },
                {
                    id: 502,
                    date: '2026-04-06',
                    category: 'other',
                    name: 'æ©Ÿå ´å ±åˆ° & è¡Œåˆ©æ‰˜é‹',
                    time: '10:00',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'IT-285 (ç¬¬ä¸€èˆªå»ˆ)',
                    description: 'å‰å¾€å°ç£è™èˆªæ«ƒå°è¾¦ç†ç™»æ©Ÿã€‚è¨˜å¾—å†æ¬¡ç¢ºèªéš¨èº«è¡Œæå…§æ²’æœ‰è¶…é 100ml çš„æ¶²é«”ã€å‰ªåˆ€ç­‰é•ç¦å“ã€‚è¡Œå‹•é›»æºå’Œé›»æ± è«‹å‹™å¿…éš¨èº«æ”œå¸¶ï¼Œä¸å¯æ‰˜é‹ã€‚'
                },
                {
                    id: 503,
                    date: '2026-04-06',
                    category: 'shopping',
                    name: 'å…ç¨…åº—æƒè²¨ & ä¼´æ‰‹ç¦®',
                    time: '10:40',
                    travelTime: 0,
                    transportType: 'walk',
                    note: 'ğŸ å¿…è²·æ¨è–¦æ¸…å–®',
                    description: 'éæµ·é—œå¾Œçš„æœ€å¾Œè¡åˆºï¼æ¨è–¦è³¼è²·ï¼š\n1. ğŸ« ROYCE\' ç”Ÿå·§å…‹åŠ› & æ´‹èŠ‹ç‰‡ (è¨˜å¾—è²·ä¿å†·è¢‹)\n2. ğŸŒ æ±äº¬é¦™è•‰ (Tokyo Banana) - é€™è£¡ä¹Ÿè²·å¾—åˆ°ï¼\n3. ğŸ° LeTAO é›™å±¤ä¹³é…ªè›‹ç³• (ä¾†è‡ªåŒ—æµ·é“çš„ç¾å‘³)\n4. ğŸŸ è–¯æ¢ä¸‰å…„å¼Ÿ (Jaga Pokkuru)\n5. ğŸµ äº¬éƒ½åŒ—å±±èŒ¶ä¹‹è“ (æ¿ƒéƒæŠ¹èŒ¶é¤…ä¹¾)\n6. ğŸ¬ å‘¼å¸å·§å…‹åŠ› (å¤§é˜ªé™å®šï¼Œå¤§åŒ…è£é©åˆåˆ†é€)\nğŸ’¡ æç¤ºï¼šå‰©ä¸‹çš„æ—¥å¹£é›¶éŒ¢å¯ä»¥åœ¨é€™è£¡å…¨éƒ¨èŠ±æ‰ï¼Œä¸è¶³çš„é‡‘é¡å†åˆ·å¡ã€‚'
                },
                {
                    id: 504,
                    date: '2026-04-06',
                    category: 'flight',
                    name: 'èˆªç­ IT-285 KIX->KHH',
                    time: '12:00',
                    travelTime: 0,
                    transportType: 'flight',
                    note: 'èµ·é£› 12:00 / æŠµé” 14:00',
                    description: 'å¸¶è‘—æ»¿æ»¿çš„å›æ†¶ï¼ˆå’Œè¶…é‡çš„è¡Œæï¼‰å›å®¶å›‰ï¼âœˆï¸ æŠµé”é«˜é›„å¾Œè¨˜å¾—é ˜å–è¡Œæã€‚'
                }
            ];
            
            // ä½¿ç”¨ fullItineraryData ä½œç‚ºé è¨­å€¼ï¼Œè‹¥ localStorage æœ‰è³‡æ–™å‰‡ç”¨ localStorageï¼Œå¦å‰‡ç”¨ fullItineraryData (å› ç‚ºæˆ‘å€‘ç¾åœ¨å¸Œæœ›é‡ç½®å¾Œèƒ½çœ‹åˆ°è³‡æ–™)
            // ä½†ç‚ºäº†å°Šé‡ã€Œæ¸…ç©ºã€çš„è«‹æ±‚ï¼Œæˆ‘å€‘åœ¨ mount æ™‚æª¢æŸ¥ï¼Œå¦‚æœ localStorage è£¡çœŸçš„æ˜¯ç©ºçš„é™£åˆ— []ï¼Œé‚£å®ƒå°±æœƒé¡¯ç¤ºç©ºç™½ã€‚
            // é€™è£¡ç‚ºäº†æ–¹ä¾¿ï¼Œæˆ‘å€‘é è¨­å¦‚æœ localStorage æ²’æ±è¥¿ï¼Œå°±è¼‰å…¥å®Œæ•´çš„ã€‚
            const itineraryList = ref(JSON.parse(localStorage.getItem('sakura_itinerary')) || fullItineraryData);
            
            const filteredItinerary = computed(() => itineraryList.value.filter(item => item.date === selectedDate.value).sort((a, b) => a.time.localeCompare(b.time)));
            
            // é‡ç½®åŠŸèƒ½ï¼šå¼·åˆ¶å°‡è¡Œç¨‹è¡¨æ¢å¾©ç‚ºé è¨­çš„å®Œæ•´è³‡æ–™
            const resetToDefaultItinerary = () => {
                if (confirm('ç¢ºå®šè¦é‡ç½®è¡Œç¨‹è¡¨å—ï¼Ÿé€™å°‡æœƒè¦†è“‹æ‚¨ç›®å‰çš„è®Šæ›´ï¼Œä¸¦è¼‰å…¥é è¨­çš„ 4/2~4/6 å®Œæ•´è¡Œç¨‹ã€‚')) {
                    itineraryList.value = JSON.parse(JSON.stringify(fullItineraryData));
                    saveToLocal('sakura_itinerary', itineraryList.value);
                    alert('è¡Œç¨‹å·²é‡ç½®ç‚ºé è¨­ç‹€æ…‹ï¼');
                }
            };

            // === è³¼ç‰©æ¸…å–®é‚è¼¯æ›´æ–° (æˆå“¡éæ¿¾) ===
            const shoppingList = ref(JSON.parse(localStorage.getItem('sakura_shopping')) || []);
            // [æ–°å¢] ç¢ºä¿èˆŠè³‡æ–™æœ‰ ID
            shoppingList.value.forEach(item => {
                if (!item.id) item.id = Date.now() + Math.random();
            });

            const filteredShoppingList = computed(() => {
  if (currentShoppingFilter.value === 'å…¨éƒ¨') return shoppingList.value;
  return shoppingList.value.filter(item => item.owner === currentShoppingFilter.value);
});

            // === [æ–°å¢] è¡Œææ¸…å–®é‚è¼¯ (åˆ†äºº + æ–°å¢åŠŸèƒ½) ===
            const defaultPackingItems = [
                'è­·ç…§ (æœ‰æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)',
                'Visit Japan Web QRcode æˆªåœ–',
                'ç¶²å¡ / eSIM è¨­å®š',
                'æ—¥å¹£ç¾é‡‘ / ä¿¡ç”¨å¡',
                'è¡Œå‹•é›»æº (éœ€éš¨èº«æ”œå¸¶)',
                'å€‹äººå¸¸å‚™è—¥ / æšˆæ©Ÿè—¥',
                'ç‰™åˆ·ç‰™è† (æ—¥æœ¬éƒ¨åˆ†é£¯åº—ä¸ä¸»å‹•æä¾›)'
            ];

            // ç¨ç«‹çš„è¡Œææ¸…å–®äººå“¡åå–®
            const packingPeople = ref(['å£«ç¿”', 'ä¾‘å›', 'å£«å€«', 'æ¬£æ€¡', 'ç®èŒ¹', 'åª½åª½']);
            const currentPackingFilter = ref(packingPeople.value[0]);
            
            // å˜—è©¦è®€å–èˆŠè³‡æ–™ (sakura_packing) æˆ–æ–°è³‡æ–™ (sakura_packing_v2_obj)
            const rawPacking = JSON.parse(localStorage.getItem('sakura_packing_v2_obj'));
            const packingData = ref(rawPacking || {});

            // åˆå§‹åŒ–ï¼šç¢ºä¿æ¯å€‹äººéƒ½æœ‰æ¸…å–®
            // æ³¨æ„ï¼šé€™è£¡æ”¹ç”¨ packingPeople ä¾†åˆå§‹åŒ–è³‡æ–™
            packingPeople.value.forEach(person => {
                if (!packingData.value[person]) {
                    packingData.value[person] = defaultPackingItems.map((text, i) => ({
                        id: Date.now() + i + Math.random(),
                        text,
                        checked: false
                    }));
                }
            });

            // ç›£è½è®Šå‹•ä¸¦å„²å­˜
            watch(packingData, (newVal) => {
                localStorage.setItem('sakura_packing_v2_obj', JSON.stringify(newVal));
            }, { deep: true });

            const newPackingItem = ref('');
            const addPackingItem = () => {
                if (!newPackingItem.value.trim()) return;
                const person = currentPackingFilter.value;
                if (!packingData.value[person]) packingData.value[person] = [];
                
                packingData.value[person].push({
                    id: Date.now(),
                    text: newPackingItem.value,
                    checked: false
                });
                newPackingItem.value = '';
            };

            const removePackingItem = (index) => {
                if(confirm('ç¢ºå®šç§»é™¤æ­¤é …ç›®ï¼Ÿ')) {
                    const person = currentPackingFilter.value;
                    packingData.value[person].splice(index, 1);
                }
            };


            // === èŠ±è²»é‚è¼¯æ›´æ–° (æˆå“¡éæ¿¾) ===
            const expenses = ref(JSON.parse(localStorage.getItem('sakura_expenses')) || []);
            // [æ–°å¢] ç¢ºä¿èˆŠè³‡æ–™æœ‰ ID
            expenses.value.forEach(item => {
                if (!item.id) item.id = Date.now() + Math.random();
            });

            const filteredExpenses = computed(() => {
                if (!currentMemberFilter.value) return expenses.value;
                return expenses.value.filter(item => item.owner === currentMemberFilter.value);
            });
            const filteredTotalExpense = computed(() => filteredExpenses.value.reduce((sum, item) => sum + Number(item.amount), 0));
            const totalExpense = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0)); // ä¿ç•™ä¸€å€‹ç¸½è¨ˆåšåƒè€ƒ

            // [æ–°å¢] åˆªé™¤èŠ±è²»é …ç›® (ä½¿ç”¨ ID)
            const deleteExpense = (id) => { 
                if(confirm('åˆªé™¤æ­¤ç´€éŒ„ï¼Ÿ')) { 
                    const index = expenses.value.findIndex(item => item.id === id);
                    if (index !== -1) {
                        expenses.value.splice(index, 1); 
                        saveToLocal('sakura_expenses', expenses.value); 
                    }
                } 
            }

            // === [æ–°å¢] ç­†è¨˜æœ¬é‚è¼¯ ===
            const notebookList = ref(JSON.parse(localStorage.getItem('sakura_notebook')) || []);
            // [ä¿®æ­£] ç§»é™¤é‡è¤‡å®£å‘Šçš„ notebookOwners
            const currentNotebookFilter = ref(notebookOwners.value[0]); // é è¨­é¡¯ç¤ºç¬¬ä¸€å€‹äºº

            const filteredNotebookList = computed(() => {
                return notebookList.value.filter(note => note.owner === currentNotebookFilter.value)
                    .sort((a, b) => b.id - a.id); // æ–°çš„åœ¨ä¸Šé¢
            });

            const deleteNote = (id) => {
                if(confirm('ç¢ºå®šåˆªé™¤é€™å‰‡ç­†è¨˜ï¼Ÿ')) {
                    notebookList.value = notebookList.value.filter(n => n.id !== id);
                    saveToLocal('sakura_notebook', notebookList.value);
                }
            };

            // === åŒ¯ç‡é‚è¼¯ (æ›´æ–°ï¼šé›™å‘ + è‡ªå‹•æŠ“å–) ===
            const exchange = reactive({ jpy: '', twd: '' });
            const currentRate = ref(0.218); // é è¨­åŒ¯ç‡

            // æŠ“å–å³æ™‚åŒ¯ç‡
            const fetchExchangeRate = async () => {
                try {
                    const response = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                    const data = await response.json();
                    if (data && data.rates && data.rates.TWD) {
                        currentRate.value = data.rates.TWD;
                    }
                } catch (e) {
                    console.error("åŒ¯ç‡æ›´æ–°å¤±æ•—ï¼Œä½¿ç”¨é è¨­å€¼", e);
                }
            };

            const calcTwd = () => { 
                exchange.twd = exchange.jpy ? Math.round(exchange.jpy * currentRate.value) : ''; 
            }
            
            const calcJpy = () => { 
                exchange.jpy = exchange.twd ? Math.round(exchange.twd / currentRate.value) : ''; 
            }

            const today = new Date().toLocaleDateString();
            const modal = reactive({ show: false, type: '', title: '', isEdit: false });
            const formData = reactive({});
            
            const openModal = (type, item = null) => {
  modal.type = type;
  modal.show = true;
  modal.isEdit = !!item;

  // æ¸…ç©º formData
  Object.keys(formData).forEach(key => delete formData[key]);

  // ç·¨è¼¯æ¨¡å¼ï¼šç›´æ¥å¸¶å…¥
  if (item) {
    modal.title = 'ç·¨è¼¯';
    Object.assign(formData, JSON.parse(JSON.stringify(item)));
    return;
  }

  // æ–°å¢æ¨¡å¼ï¼šä¾é¡å‹çµ¦é è¨­å€¼
  if (type === 'itinerary') {
    modal.title = 'æ–°å¢è¡Œç¨‹';
    Object.assign(formData, {
      date: selectedDate.value,
      category: 'attraction',
      transportType: 'walk',
      travelTime: 15,
      name: '',
      time: '10:00',
      note: '',
      description: '',
      openHours: '',
      ticket: ''
    });
    return;
  }

  if (type === 'shopping') {
    modal.title = item ? 'ç·¨è¼¯è³¼ç‰©æ¸…å–®' : 'æ–°å¢è³¼ç‰©æ¸…å–®'; // [æ–°å¢] å‹•æ…‹æ¨™é¡Œ

    const defaultOwner =
      currentShoppingFilter.value !== 'å…¨éƒ¨'
        ? currentShoppingFilter.value
        : shoppingOwners.value[0]; // ç¬¬ä¸€ä½éå…¬è²»

    Object.assign(formData, {
      id: Date.now(), // [æ–°å¢] é è¨­ ID
      name: '',
      image: '',
      bought: false,
      owner: defaultOwner
    });
    
    // å¦‚æœæ˜¯ç·¨è¼¯ï¼Œè¦†è“‹ä¸Šé¢çš„é è¨­å€¼
    if (item) {
         Object.assign(formData, JSON.parse(JSON.stringify(item)));
    }
    return;
  }

  if (type === 'expense') {
    modal.title = item ? 'ç·¨è¼¯èŠ±è²»' : 'æ–°å¢èŠ±è²»'; // [ä¿®æ”¹] æ”¯æ´ç·¨è¼¯æ¨™é¡Œ
    
    Object.assign(formData, {
      id: Date.now(), // [æ–°å¢] é è¨­ ID
      date: selectedDate.value,
      category: 'food',
      method: 'ç¾é‡‘',
      amount: '',
      name: '',
      owner: currentMemberFilter.value || travelers.value[1] // é è¨­ã€Œç¿”ã€(è·³éå…¬è²»)
    });

    // å¦‚æœæ˜¯ç·¨è¼¯ï¼Œè¦†è“‹ä¸Šé¢çš„é è¨­å€¼
    if (item) {
         Object.assign(formData, JSON.parse(JSON.stringify(item)));
    }
    return;
  }

  if (type === 'notebook') {
    modal.title = item ? 'ç·¨è¼¯ç­†è¨˜' : 'æ–°å¢ç­†è¨˜'; // [ä¿®æ”¹] æ”¯æ´ç·¨è¼¯æ¨™é¡Œ
    Object.assign(formData, {
      id: Date.now(), // é è¨­ ID (æ–°å¢ç”¨)
      title: '',
      content: '',
      owner: currentNotebookFilter.value || notebookOwners.value[0]
    });
    
    // å¦‚æœæ˜¯ç·¨è¼¯ï¼Œè¦†è“‹ä¸Šé¢çš„é è¨­å€¼
    if (item) {
         Object.assign(formData, JSON.parse(JSON.stringify(item)));
    }
    return;
  }
};

            const closeModal = () => modal.show = false;
            const submitForm = () => { 
                if (modal.type === 'itinerary') { 
                    if (modal.isEdit) { 
                        const index = itineraryList.value.findIndex(i => i.id === formData.id); 
                        if (index !== -1) itineraryList.value[index] = { ...formData }; 
                    } else { 
                        itineraryList.value.push({ ...formData, id: Date.now() }); 
                    } 
                    saveToLocal('sakura_itinerary', itineraryList.value); 
                } else if (modal.type === 'shopping') { 
                    if (modal.isEdit) {
                        const index = shoppingList.value.findIndex(i => i.id === formData.id);
                        if (index !== -1) shoppingList.value[index] = { ...formData };
                    } else {
                        shoppingList.value.push({ ...formData }); 
                    }
                    saveToLocal('sakura_shopping', shoppingList.value); 
                } else if (modal.type === 'expense') { 
                    if (modal.isEdit) {
                        const index = expenses.value.findIndex(e => e.id === formData.id);
                        if (index !== -1) expenses.value[index] = { ...formData };
                    } else {
                        expenses.value.push({ ...formData }); 
                    }
                    saveToLocal('sakura_expenses', expenses.value); 
                } else if (modal.type === 'notebook') {
                    // [ä¿®æ”¹] ç­†è¨˜æœ¬å„²å­˜é‚è¼¯ï¼Œæ”¯æ´ç·¨è¼¯æ›´æ–°
                    if (modal.isEdit) {
                        const index = notebookList.value.findIndex(n => n.id === formData.id);
                        if (index !== -1) notebookList.value[index] = { ...formData };
                    } else {
                        notebookList.value.push({ ...formData, id: Date.now() });
                    }
                    saveToLocal('sakura_notebook', notebookList.value);
                }
                closeModal(); 
            };
            const confirmDeleteItinerary = () => { if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) { itineraryList.value = itineraryList.value.filter(i => i.id !== formData.id); saveToLocal('sakura_itinerary', itineraryList.value); closeModal(); } };
            const deleteItineraryItem = (id) => { if (confirm('ç¢ºå®šè¦ç›´æ¥åˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) { itineraryList.value = itineraryList.value.filter(i => i.id !== id); saveToLocal('sakura_itinerary', itineraryList.value); } };
            // [ä¿®æ­£] æ”¹ç”¨ ID åˆªé™¤è³¼ç‰©é …ç›®
            const deleteShoppingItem = (id) => { 
                if(confirm('åˆªé™¤æ­¤å•†å“ï¼Ÿ')) { 
                    const index = shoppingList.value.findIndex(i => i.id === id);
                    if (index !== -1) {
                        shoppingList.value.splice(index, 1); 
                        saveToLocal('sakura_shopping', shoppingList.value); 
                    }
                } 
            }
            // [æ³¨æ„] æ­¤è™•ç§»é™¤äº†èˆŠç‰ˆä¾è³´ index çš„ deleteExpenseï¼Œæ”¹ç”¨ä¸Šæ–¹å®šç¾©çš„æ–°ç‰ˆ deleteExpense
            const handleImageUpload = (e) => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { formData.image = e.target.result; }; reader.readAsDataURL(file); };
            const moveItem = (index, direction) => { alert("æ‹–æ›³æ’åºåŠŸèƒ½éœ€å¾Œç«¯æˆ–æ›´è¤‡é›œçš„ç‹€æ…‹ç®¡ç†ï¼Œæ­¤ç‚ºå±•ç¤ºç‰ˆæœ¬ã€‚"); };
            const openMap = (keyword) => { window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(keyword)}`, '_blank'); };
            const saveToLocal = (key, data) => localStorage.setItem(key, JSON.stringify(data));

const cloudSync = reactive({
  state: "idle",          // idle | syncing | synced | error
  message: "å°šæœªåŒæ­¥",
  lastSyncedAt: null,
  error: null
});

let isHydratingFromCloud = false;   // â˜…é—œéµï¼šé¿å…ã€Œæ‹‰é›²ç«¯ã€æ™‚ watch åˆç«‹åˆ»ä¸Šå‚³
let lastCloudUpdatedAt = null;      // â˜…å¯é¸ï¼šç”¨ä¾†åˆ¤æ–·ç‰ˆæœ¬æ–°èˆŠ

const waitForCloudFns = () => new Promise((resolve, reject) => {
  const start = Date.now();
  const timer = setInterval(() => {
    const ok = (typeof window.__CLOUD_GET_STATE__ === "function") &&
               (typeof window.__CLOUD_SET_STATE__ === "function");
    if (ok) { clearInterval(timer); resolve(true); }
    if (Date.now() - start > 8000) { clearInterval(timer); reject(new Error("Cloud functions not ready")); }
  }, 100);
});

const buildPayload = () => ({
  itinerary: itineraryList.value,
  shopping: shoppingList.value,
  expenses: expenses.value,
  notebook: notebookList.value, // [æ–°å¢]
  updatedAt: new Date().toISOString()
});

const applyCloudToLocal = (cloud) => {
  if (!cloud) return;

  // å¥—ç”¨åˆ° Vue state
  if (Array.isArray(cloud.itinerary)) itineraryList.value = cloud.itinerary;
  if (Array.isArray(cloud.shopping))  shoppingList.value  = cloud.shopping;
  if (Array.isArray(cloud.expenses))  expenses.value      = cloud.expenses;
  if (Array.isArray(cloud.notebook))  notebookList.value  = cloud.notebook; // [æ–°å¢]

  // åŒæ­¥åˆ° localStorageï¼ˆè®“ä¸‹æ¬¡é–‹å•Ÿé€Ÿåº¦å¿«ï¼‰
  saveToLocal('sakura_itinerary', itineraryList.value);
  saveToLocal('sakura_shopping', shoppingList.value);
  saveToLocal('sakura_expenses', expenses.value);
  saveToLocal('sakura_notebook', notebookList.value); // [æ–°å¢]
  
  lastCloudUpdatedAt = cloud.updatedAt || null;
};

const pullFromCloudOnce = async () => {
  try {
    await waitForCloudFns();

    cloudSync.state = "syncing";
    cloudSync.message = "å¾é›²ç«¯è¼‰å…¥ä¸­â€¦";
    cloudSync.error = null;

    const cloud = await window.__CLOUD_GET_STATE__();

    isHydratingFromCloud = true;
    applyCloudToLocal(cloud);
    isHydratingFromCloud = false;

    cloudSync.state = "synced";
    cloudSync.message = cloud ? "å·²å¾é›²ç«¯è¼‰å…¥" : "é›²ç«¯ç›®å‰æ²’æœ‰è³‡æ–™";
    cloudSync.lastSyncedAt = new Date().toISOString();
  } catch (err) {
    console.error("pullFromCloudOnce failed:", err);
    isHydratingFromCloud = false;

    cloudSync.state = "error";
    cloudSync.message = "é›²ç«¯è¼‰å…¥å¤±æ•—ï¼Œé»é€™è£¡é‡è©¦";
    cloudSync.error = err?.message || String(err);
  }
};

const pushToCloud = async () => {
  await waitForCloudFns();
  await window.__CLOUD_SET_STATE__(buildPayload());
};

const manualCloudSync = async () => {
  try {
    if (isHydratingFromCloud) return;

    cloudSync.state = "syncing";
    cloudSync.message = "åŒæ­¥ä¸­â€¦";
    cloudSync.error = null;

    await pushToCloud();

    cloudSync.state = "synced";
    cloudSync.message = "å·²åŒæ­¥åˆ°é›²ç«¯";
    cloudSync.lastSyncedAt = new Date().toISOString();
  } catch (err) {
    console.error(err);
    cloudSync.state = "error";
    cloudSync.message = "åŒæ­¥å¤±æ•—ï¼Œé»é€™è£¡é‡è©¦";
    cloudSync.error = err?.message || String(err);
  }
};

onMounted(() => {
  pullFromCloudOnce();
});

let syncTimer = null;
const scheduleSync = () => {
  if (isHydratingFromCloud) return;
  clearTimeout(syncTimer);
  syncTimer = setTimeout(() => manualCloudSync(), 800);
};

watch(itineraryList, scheduleSync, { deep: true });
watch(shoppingList, scheduleSync, { deep: true });
watch(expenses, scheduleSync, { deep: true });
watch(notebookList, scheduleSync, { deep: true }); // [æ–°å¢]
// åŠ å…¥ packingData åˆ°é›²ç«¯åŒæ­¥ç›£è½ (é›–ç„¶é›²ç«¯çµæ§‹å¯èƒ½é‚„æ²’æ”¯æ´ï¼Œä½†æœ¬åœ°å„²å­˜å·²å®Œæˆ)
watch(packingData, scheduleSync, { deep: true });

            const getCategoryLabel = (cat) => ({ attraction: 'æ™¯é»', food: 'ç¾é£Ÿ', shopping: 'è³¼ç‰©', accommodation: 'ä½å®¿', flight: 'èˆªç­', transport: 'äº¤é€š', other: 'å…¶ä»–' }[cat] || 'å…¶ä»–');
            const getCategoryColor = (cat) => ({ attraction: 'bg-red-100 text-red-500', food: 'bg-orange-100 text-orange-500', shopping: 'bg-pink-100 text-pink-500', accommodation: 'bg-purple-100 text-purple-500', transport: 'bg-green-100 text-green-600' }[cat] || 'bg-gray-100 text-gray-500');
            const getTransportIcon = (type) => type === 'walk' ? 'fa-solid fa-person-walking' : 'fa-solid fa-train-subway';
            const getExpenseIcon = (cat) => `fa-solid ${{ transport: 'fa-train', food: 'fa-utensils', accommodation: 'fa-bed', ticket: 'fa-ticket', shopping: 'fa-bag-shopping', other: 'fa-circle' }[cat] || 'fa-circle'}`;

            return { 
  currentTab, tabs, days, selectedDate, filteredItinerary, modal, formData, openModal, closeModal, submitForm,
  shoppingList, filteredShoppingList,
  expenses, filteredExpenses, totalExpense, filteredTotalExpense,
  packingData, currentPackingFilter, newPackingItem, addPackingItem, removePackingItem, // åŒ¯å‡º packing ç›¸é—œ
  packingPeople, // åŒ¯å‡ºç¨ç«‹çš„è¡Œææ¸…å–®äººå“¡åå–®
  notebookList, filteredNotebookList, currentNotebookFilter, notebookOwners, deleteNote, // åŒ¯å‡º notebook ç›¸é—œ
  exchange, calcTwd, calcJpy, currentRate, today,
  getCategoryLabel, getCategoryColor, getTransportIcon, getExpenseIcon,
  editItinerary: (item) => openModal('itinerary', item),
  confirmDeleteItinerary, deleteItineraryItem, deleteShoppingItem, deleteExpense,
  handleImageUpload, moveItem, openMap,
  isWeatherExpanded, toggleWeather, weatherData, weatherLoading,
  travelers, shoppingTravelers, shoppingOwners,
  currentShoppingFilter,  
  currentMemberFilter,
  currentDayCities, changeWeatherCity,
  bannerImage, 
  handleImageError,daysUntilTrip,
  cloudSync,
  manualCloudSync,
  resetToDefaultItinerary,
  showSplash
};
}

    }).mount('#app');
</script>

<style>
    @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .animate-slide-up { animation: slide-up 0.3s ease-out forwards; }
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
    .animate-fade-in { animation: fade-in 0.2s ease-out forwards; }
    .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
</style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { 
    getFirestore, doc, getDoc, setDoc, serverTimestamp 
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  const firebaseConfig = {
  apiKey: "AIzaSyDc1X5CFJc7ThluEmPN--uVKxSfrlZavek",
  authDomain: "osa0402test.firebaseapp.com",
  projectId: "osa0402test",
  storageBucket: "osa0402test.firebasestorage.app",
  messagingSenderId: "49893570598",
  appId: "1:49893570598:web:c334c87afbd84ee329cee7",
  measurementId: "G-HTNRTFVN0S"
};


  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

const TRIP_ID = "keihan_2026_0402";

  const stateDoc = () => doc(db, "trips", TRIP_ID, "state", "main");   

window.__CLOUD_GET_STATE__ = async () => {
    const snap = await getDoc(stateDoc());
    return snap.exists() ? snap.data() : null;
  };

window.__CLOUD_SET_STATE__ = async (payload) => {
    await setDoc(doc(db, "trips", TRIP_ID), { updatedAt: serverTimestamp() }, { merge: true });
    await setDoc(stateDoc(), payload, { merge: true });
    return true;
  };

console.log("âœ… Firebase ready. TRIP_ID =", TRIP_ID);


console.log("ğŸ”¥ firebase module script loaded");

</script>
</body>
</html>
